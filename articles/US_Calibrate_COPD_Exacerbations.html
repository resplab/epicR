<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>US_Calibrate COPD Exacerbations • epicR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="US_Calibrate COPD Exacerbations">
<style>
/* Event table styles */
.event-table table {
    width: 100%;
    border-collapse: collapse;
    margin: 20px 0;
    font-size: 1em;
    font-family: Arial, sans-serif;
    text-align: left;
    border: none;
}
.event-table table th {
    background-color: #f3f4f5;
    font-weight: bold;
    border-bottom: 3px solid #333;
    padding: 10px;
}
.event-table table td {
    padding: 8px;
}
.event-table table tr:nth-child(even) {
    background-color: #f3f4f5;
}
.event-table table tr:nth-child(odd) {
    background-color: #ffffff;
}

/* Dropdown table styles */
.custom-table-container-dropdown table {
    width: 100%;
    table-layout: fixed;
    border-collapse: collapse;
    margin: 20px 0;
    font-size: 1em;
    font-family: Arial, sans-serif;
    text-align: left;
    border: 1px solid #ddd;
}
.custom-table-container-dropdown table th {
    background-color: #f3f4f5;
    font-weight: bold;
    border-bottom: 3px solid #333;
    padding: 10px;
    text-align: left;
}
.custom-table-container-dropdown table td {
    padding: 8px;
}
.btn-primary {
    color: #fff;
    background-color: #007bff;
    border: none;
    padding: 5px 10px;
    font-size: 0.9em;
    cursor: pointer;
    border-radius: 3px;
}
.btn-primary:hover {
    background-color: #0056b3;
}
.custom-collapse {
    margin-top: 10px;
    padding: 10px;
    border: 1px solid #ddd;
    background-color: #f9f9f9;
    display: none;
}
.custom-collapse.show {
    display: block;
}

/* General table styles */
.custom-table-container table {
    width: 100%;
    border-collapse: collapse;
    margin: 20px 0;
    font-size: 1em;
    font-family: Arial, sans-serif;
    text-align: left;
    border: 1px solid #ddd;
}
.custom-table-container table th {
    background-color: #f3f4f5;
    font-weight: bold;
    border-bottom: 3px solid #333;
    padding: 10px;
    text-align: left;
}
.custom-table-container table td {
    padding: 8px;
    border-bottom: 1px solid #ddd;
}
.custom-table-container table tr:nth-child(even) {
    background-color: #f9f9f9;
}
.custom-table-container table tr:nth-child(odd) {
    background-color: #ffffff;
}
.custom-table-container table tr:hover {
    background-color: #b780ff;
}
</style>
<script>
document.addEventListener('DOMContentLoaded', function() {
  document.querySelectorAll('.btn-primary').forEach(function(button) {
    button.addEventListener('click', function() {
      var target = document.querySelector(button.getAttribute('data-target'));
      if (target) {
        target.classList.toggle('show');
      }
    });
  });
});
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">epicR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.9.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/AddingNewCountry.html">Adding a New Country to epicR</a></li>
    <li><a class="dropdown-item" href="../articles/BackgroundEPIC.html">EPIC Background</a></li>
    <li><a class="dropdown-item" href="../articles/Canada_Calibrate_COPD_Exacerbations.html">Canada_Calibrate COPD Exacerbations</a></li>
    <li><a class="dropdown-item" href="../articles/GettingStarted.html">Getting Started with EPIC</a></li>
    <li><a class="dropdown-item" href="../articles/US_Calibrate_Background_Mortality.html">US_Calibrate Background Mortality</a></li>
    <li><a class="dropdown-item" href="../articles/US_Calibrate_COPD_Exacerbations.html">US_Calibrate COPD Exacerbations</a></li>
    <li><a class="dropdown-item" href="../articles/US_Calibrate_COPD_Prevalence.html">US_Calibrate COPD Prevalence</a></li>
    <li><a class="dropdown-item" href="../articles/US_Calibrate_Demographics.html">US_Calibrate Demographics</a></li>
    <li><a class="dropdown-item" href="../articles/US_Calibrate_Smoking_Status.html">US_Calibrate Smoking Status</a></li>
    <li><a class="dropdown-item" href="../articles/US_Payoffs.html">US_Payoffs</a></li>
    <li><a class="dropdown-item" href="../articles/UsingEPICinR.html">Using EPIC in R</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>US_Calibrate COPD Exacerbations</h1>
            
      

      <div class="d-none name"><code>US_Calibrate_COPD_Exacerbations.Rmd</code></div>
    </div>

    
    
<div class="section level3">
<h3 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h3>
<p>This document outlines the calibration process undertaken to align
the model’s outputs with validation targets for COPD exacerbations,
using the ACCEPT study, Hoogendorn et al 2021, and CanCOLD.</p>
</div>
<div class="section level2">
<h2 id="calibration-of-copd-exacerbation-rates">Calibration of COPD Exacerbation Rates<a class="anchor" aria-label="anchor" href="#calibration-of-copd-exacerbation-rates"></a>
</h2>
<p>This section outlines the internal validation process conducted to
align the model’s simulated COPD exacerbation rates with empirical
targets drawn from key reference studies. The validation focused on both
diagnosed and undiagnosed populations and was stratified by GOLD stage
and exacerbation severity (total, moderate/severe, and severe only).
Detailed validation targets and associated calibration code are
presented below.</p>
<p><strong>Validation References:</strong></p>
<ul>
<li>Ford et al. 2015 (DOI: 10.1378/chest.14-2146)</li>
<li>Hoogendoorn et al. 2021 (DOI: 10.1183/09031936.00043710)</li>
<li>Wallace et al. 2019 (DOI: 10.18553/jmcp.2019.25.2.205)</li>
<li>CanCOLD study (DOI: 10.3109/15412555.2012.665520)</li>
</ul>
<hr>
<div class="section level3">
<h3 id="validation-targets">
<strong>Validation Targets</strong><a class="anchor" aria-label="anchor" href="#validation-targets"></a>
</h3>
<div class="section level4">
<h4 id="total-rate-of-exacerbation-per-100000-individuals-ford-et-al--2015">
<strong>Total Rate of Exacerbation per 100,000 individuals (Ford et
al. 2015)</strong><a class="anchor" aria-label="anchor" href="#total-rate-of-exacerbation-per-100000-individuals-ford-et-al--2015"></a>
</h4>
<p>Ford et al. 2015 reported age-specific hospitalization rates for COPD
but did not provide an aggregated rate for adults aged &gt;40 years. As
such this estimate was not available, a combined rate was derived as the
best available evidence for a population-level measure of COPD-related
hospitalizations per 100,000 individuals in this age group.</p>
<p>To calculate this estimate, age-specific hospitalization rates
reported in Table 1 of Ford et al. 2015 and were weighted by the U.S.
Census population counts for 2012. Rates reported in Table 1 per 100,000
were 276.9 for ages 45–64, 939.4 for ages 65–84, and 1,181.2 for ages
≥85. Each rate was multiplied by the corresponding population size from
the U.S. Census population numbers for 2012 (81.5 million, 35.0 million,
and 5.9 million, respectively) to obtain the expected number of
hospitalizations within each strata. These values were summed and
divided by the total population aged &gt;40 years (122.4 million), then
scaled per 100,000. The resulting combined hospitalization rate was
approximately 510 per 100,000 individuals aged &gt;40 years in 2012.</p>
<ul>
<li>
<strong>Total Exacerbation Rate:</strong> 510 per 100,000
individuals</li>
</ul>
</div>
<div class="section level4">
<h4 id="diagnosed-patients-total-exacerbation-rate-hoogendoorn-et-al--2021">
<strong>Diagnosed Patients – Total Exacerbation Rate (Hoogendoorn et
al. 2021)</strong><a class="anchor" aria-label="anchor" href="#diagnosed-patients-total-exacerbation-rate-hoogendoorn-et-al--2021"></a>
</h4>
<p>Simulated rates were compared against those reported by Hoogendoorn
et al. 2021: - <strong>GOLD 1:</strong> 0.82<br>
- <strong>GOLD 2:</strong> 1.17<br>
- <strong>GOLD 3:</strong> 1.61<br>
- <strong>GOLD 4:</strong> 2.10</p>
</div>
<div class="section level4">
<h4 id="diagnosed-patients-moderate-and-severe-exacerbation-rates-wallace-et-al--2019-study">
<strong>Diagnosed Patients – Moderate and Severe Exacerbation Rates
(Wallace et al. 2019 Study)</strong><a class="anchor" aria-label="anchor" href="#diagnosed-patients-moderate-and-severe-exacerbation-rates-wallace-et-al--2019-study"></a>
</h4>
<p>Wallace et al. 2019 provided target rates for moderate and severe
exacerbations: - <strong>GOLD 1:</strong> 0.404 - <strong>GOLD
2:</strong> 0.489<br>
- <strong>GOLD 3:</strong> 0.836 - <strong>GOLD 4:</strong> 0.891</p>
</div>
<div class="section level4">
<h4 id="diagnosed-patients-severe-exacerbation-rates-wallace-et-al--2019-study">
<strong>Diagnosed Patients – Severe Exacerbation Rates</strong>
(Wallace et al. 2019 Study)<a class="anchor" aria-label="anchor" href="#diagnosed-patients-severe-exacerbation-rates-wallace-et-al--2019-study"></a>
</h4>
<p>Wallace et al. 2019 provided target rates for severe exacerbations: -
<strong>GOLD 1:</strong> 0.12 - <strong>GOLD 2:</strong> 0.139<br>
- <strong>GOLD 3:</strong> 0.254<br>
- <strong>GOLD 4:</strong> 0.422</p>
</div>
<div class="section level4">
<h4 id="undiagnosed-patients-total-exacerbation-rate-cancold">
<strong>Undiagnosed Patients – Total Exacerbation Rate
(CanCOLD)</strong><a class="anchor" aria-label="anchor" href="#undiagnosed-patients-total-exacerbation-rate-cancold"></a>
</h4>
<p>For the undiagnosed subgroup, exacerbation rates were benchmarked
against CanCOLD data: - <strong>Total population:</strong> 0.30<br>
- <strong>GOLD 1:</strong> 0.24<br>
- <strong>GOLD 2+:</strong> 0.40</p>
</div>
<div class="section level4">
<h4 id="overall-and-gold-stratified-total-exacerbation-rates-cancold">
<strong>Overall and GOLD-Stratified Total Exacerbation Rates
(CanCOLD)</strong><a class="anchor" aria-label="anchor" href="#overall-and-gold-stratified-total-exacerbation-rates-cancold"></a>
</h4>
<p>For all individuals (diagnosed and undiagnosed), total exacerbation
rates per year were compared against the CanCOLD study benchmarks: -
<strong>Total population:</strong> 0.39<br>
- <strong>GOLD 1:</strong> 0.28<br>
- <strong>GOLD 2+:</strong> 0.53</p>
<hr>
<p>The calibration code below performs the relevant calculations and
visualizations for each validation target.</p>
</div>
</div>
<div class="section level3">
<h3 id="step-1-load-libraries-and-setup">Step 1: Load libraries and setup<a class="anchor" aria-label="anchor" href="#step-1-load-libraries-and-setup"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">epicR</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://jrnold.github.io/ggthemes/" class="external-link">ggthemes</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://scales.r-lib.org" class="external-link">scales</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hadley/reshape" class="external-link">reshape2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define event codes</span></span>
<span><span class="va">EVENT_EXACERBATION</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span><span class="va">EVENT_END</span> <span class="op">&lt;-</span> <span class="fl">11</span>  <span class="co"># Updated event_end code after MI/stroke/HF removal</span></span>
<span></span>
<span><span class="co"># Load EPIC general settings</span></span>
<span><span class="va">settings</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_default_settings.html">get_default_settings</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">settings</span><span class="op">$</span><span class="va">record_mode</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">settings</span><span class="op">$</span><span class="va">n_base_agents</span> <span class="op">&lt;-</span> <span class="fl">3.5e6</span></span>
<span></span>
<span><span class="co"># Load input with US config</span></span>
<span><span class="va">input</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_input.html">get_input</a></span><span class="op">(</span>jurisdiction <span class="op">=</span> <span class="st">"us"</span><span class="op">)</span></span>
<span><span class="va">time_horizon</span> <span class="op">&lt;-</span> <span class="fl">26</span></span>
<span></span>
<span><span class="co"># Modify intercept value to calibrate proportion of COPD exacerbations</span></span>
<span><span class="va">input</span><span class="op">$</span><span class="va">values</span><span class="op">$</span><span class="va">exacerbation</span><span class="op">$</span><span class="va">ln_rate_betas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>intercept <span class="op">=</span> <span class="fl">1.8</span>, female <span class="op">=</span> <span class="fl">0</span>, age <span class="op">=</span> <span class="fl">0.04082</span> <span class="op">*</span> <span class="fl">0.1</span>, fev1 <span class="op">=</span> <span class="op">-</span><span class="fl">1.5</span>, smoking_status <span class="op">=</span> <span class="fl">0.7</span>, gold1 <span class="op">=</span> <span class="fl">0.15</span> , gold2 <span class="op">=</span> <span class="op">-</span><span class="fl">0.10</span> , gold3 <span class="op">=</span> <span class="op">-</span><span class="fl">0.40</span> , gold4 <span class="op">=</span> <span class="op">-</span><span class="fl">0.75</span> , diagnosis_effect <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">input</span><span class="op">$</span><span class="va">values</span><span class="op">$</span><span class="va">exacerbation</span><span class="op">$</span><span class="va">logit_severity_betas</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>intercept1 <span class="op">=</span> <span class="op">-</span><span class="fl">0.309</span>, intercept2 <span class="op">=</span> <span class="fl">2.502</span>, intercept3 <span class="op">=</span> <span class="fl">5.508</span>, female <span class="op">=</span> <span class="op">-</span><span class="fl">0.764</span>, age <span class="op">=</span> <span class="op">-</span><span class="fl">0.007</span>, fev1 <span class="op">=</span> <span class="fl">0.98</span>, smoking_status <span class="op">=</span> <span class="fl">0.348</span>, pack_years <span class="op">=</span> <span class="op">-</span><span class="fl">0.001</span> , BMI <span class="op">=</span> <span class="fl">0.018</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run the model</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate.html">simulate</a></span><span class="op">(</span>settings <span class="op">=</span> <span class="va">settings</span>, input <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">values</span>, return_events <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">all_events</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">$</span><span class="va">events</span></span>
<span><span class="va">exac_events</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">all_events</span>, <span class="va">event</span> <span class="op">==</span> <span class="va">EVENT_EXACERBATION</span><span class="op">)</span></span>
<span><span class="va">exit_events</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">all_events</span>, <span class="va">event</span> <span class="op">==</span> <span class="va">EVENT_END</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Follow_up_GOLD</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">last_GOLD_transition_time</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">all_events</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">all_events</span><span class="op">[</span><span class="va">i</span>, <span class="st">"id"</span><span class="op">]</span> <span class="op">!=</span> <span class="va">all_events</span><span class="op">[</span><span class="va">i</span> <span class="op">-</span> <span class="fl">1</span>, <span class="st">"id"</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">last_GOLD_transition_time</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">(</span><span class="va">all_events</span><span class="op">[</span><span class="va">i</span>, <span class="st">"id"</span><span class="op">]</span> <span class="op">==</span> <span class="va">all_events</span><span class="op">[</span><span class="va">i</span> <span class="op">-</span> <span class="fl">1</span>, <span class="st">"id"</span><span class="op">]</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">all_events</span><span class="op">[</span><span class="va">i</span>, <span class="st">"gold"</span><span class="op">]</span> <span class="op">!=</span> <span class="va">all_events</span><span class="op">[</span><span class="va">i</span> <span class="op">-</span> <span class="fl">1</span>, <span class="st">"gold"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">Follow_up_GOLD</span><span class="op">[</span><span class="va">all_events</span><span class="op">[</span><span class="va">i</span> <span class="op">-</span> <span class="fl">1</span>, <span class="st">"gold"</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="va">Follow_up_GOLD</span><span class="op">[</span><span class="va">all_events</span><span class="op">[</span><span class="va">i</span> <span class="op">-</span> <span class="fl">1</span>, <span class="st">"gold"</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span> <span class="va">all_events</span><span class="op">[</span><span class="va">i</span> <span class="op">-</span> <span class="fl">1</span>, <span class="st">"followup_after_COPD"</span><span class="op">]</span> <span class="op">-</span></span>
<span>      <span class="va">last_GOLD_transition_time</span></span>
<span>    <span class="va">last_GOLD_transition_time</span> <span class="op">&lt;-</span> <span class="va">all_events</span><span class="op">[</span><span class="va">i</span> <span class="op">-</span> <span class="fl">1</span>, <span class="st">"followup_after_COPD"</span><span class="op">]</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">all_events</span><span class="op">[</span><span class="va">i</span>, <span class="st">"event"</span><span class="op">]</span> <span class="op">==</span> <span class="va">EVENT_END</span><span class="op">)</span></span>
<span>    <span class="va">Follow_up_GOLD</span><span class="op">[</span><span class="va">all_events</span><span class="op">[</span><span class="va">i</span>, <span class="st">"gold"</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="va">Follow_up_GOLD</span><span class="op">[</span><span class="va">all_events</span><span class="op">[</span><span class="va">i</span>, <span class="st">"gold"</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span> <span class="va">all_events</span><span class="op">[</span><span class="va">i</span>, <span class="st">"followup_after_COPD"</span><span class="op">]</span> <span class="op">-</span></span>
<span>      <span class="va">last_GOLD_transition_time</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="co">#----------------------------DIAGNOSED ------------------------------------</span></span>
<span><span class="co">#-------------------------------------------------------------------------</span></span>
<span></span>
<span><span class="va">all_events_diagnosed</span>          <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">all_events</span>, <span class="va">diagnosis</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">gold</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">)</span></span>
<span><span class="va">exac_events_diagnosed</span>         <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">all_events_diagnosed</span>, <span class="va">event</span> <span class="op">==</span> <span class="va">EVENT_EXACERBATION</span> <span class="op">)</span></span>
<span><span class="va">sev_exac_events_diagnosed</span>    <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">all_events_diagnosed</span>, <span class="va">event</span> <span class="op">==</span> <span class="va">EVENT_EXACERBATION</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">exac_status</span> <span class="op">==</span> <span class="fl">3</span> <span class="op">|</span> <span class="va">exac_status</span> <span class="op">==</span> <span class="fl">4</span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="va">mod_sev_exac_events_diagnosed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">all_events_diagnosed</span>, <span class="va">event</span> <span class="op">==</span> <span class="va">EVENT_EXACERBATION</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">exac_status</span> <span class="op">==</span> <span class="fl">3</span> <span class="op">|</span> <span class="va">exac_status</span> <span class="op">==</span> <span class="fl">4</span> <span class="op">|</span> <span class="va">exac_status</span> <span class="op">==</span> <span class="fl">2</span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="va">exit_events_diagnosed</span>         <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">all_events_diagnosed</span>, <span class="va">event</span> <span class="op">==</span> <span class="va">EVENT_END</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Follow_up_GOLD_diagnosed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">last_GOLD_transition_time_diagnosed</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">all_events_diagnosed</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">(</span><span class="va">all_events_diagnosed</span><span class="op">[</span><span class="va">i</span>, <span class="st">"id"</span><span class="op">]</span> <span class="op">!=</span> <span class="va">all_events_diagnosed</span><span class="op">[</span><span class="va">i</span> <span class="op">-</span> <span class="fl">1</span>, <span class="st">"id"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">last_GOLD_transition_time_diagnosed</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">(</span><span class="va">all_events_diagnosed</span><span class="op">[</span><span class="va">i</span>, <span class="st">"id"</span><span class="op">]</span> <span class="op">==</span> <span class="va">all_events_diagnosed</span><span class="op">[</span><span class="va">i</span> <span class="op">-</span> <span class="fl">1</span>, <span class="st">"id"</span><span class="op">]</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">all_events_diagnosed</span><span class="op">[</span><span class="va">i</span>, <span class="st">"gold"</span><span class="op">]</span> <span class="op">!=</span> <span class="va">all_events_diagnosed</span><span class="op">[</span><span class="va">i</span> <span class="op">-</span> <span class="fl">1</span>, <span class="st">"gold"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">Follow_up_GOLD_diagnosed</span><span class="op">[</span><span class="va">all_events_diagnosed</span><span class="op">[</span><span class="va">i</span> <span class="op">-</span> <span class="fl">1</span>, <span class="st">"gold"</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="va">Follow_up_GOLD_diagnosed</span><span class="op">[</span><span class="va">all_events_diagnosed</span><span class="op">[</span><span class="va">i</span> <span class="op">-</span> <span class="fl">1</span>, <span class="st">"gold"</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span> <span class="op">(</span><span class="va">all_events_diagnosed</span><span class="op">[</span><span class="va">i</span> <span class="op">-</span> <span class="fl">1</span>, <span class="st">"local_time"</span><span class="op">]</span><span class="op">-</span><span class="va">all_events_diagnosed</span><span class="op">[</span><span class="va">i</span> <span class="op">-</span> <span class="fl">1</span>, <span class="st">"time_at_diagnosis"</span><span class="op">]</span><span class="op">)</span> <span class="op">-</span></span>
<span>      <span class="va">last_GOLD_transition_time_diagnosed</span></span>
<span>    <span class="va">last_GOLD_transition_time_diagnosed</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">all_events_diagnosed</span><span class="op">[</span><span class="va">i</span> <span class="op">-</span> <span class="fl">1</span>, <span class="st">"local_time"</span><span class="op">]</span><span class="op">-</span><span class="va">all_events_diagnosed</span><span class="op">[</span><span class="va">i</span> <span class="op">-</span> <span class="fl">1</span>, <span class="st">"time_at_diagnosis"</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">all_events_diagnosed</span><span class="op">[</span><span class="va">i</span>, <span class="st">"event"</span><span class="op">]</span> <span class="op">==</span> <span class="va">EVENT_END</span><span class="op">)</span></span>
<span>    <span class="va">Follow_up_GOLD_diagnosed</span><span class="op">[</span><span class="va">all_events_diagnosed</span><span class="op">[</span><span class="va">i</span>, <span class="st">"gold"</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="va">Follow_up_GOLD_diagnosed</span><span class="op">[</span><span class="va">all_events_diagnosed</span><span class="op">[</span><span class="va">i</span>, <span class="st">"gold"</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span> <span class="op">(</span><span class="va">all_events_diagnosed</span><span class="op">[</span><span class="va">i</span>, <span class="st">"local_time"</span><span class="op">]</span><span class="op">-</span><span class="va">all_events_diagnosed</span><span class="op">[</span><span class="va">i</span>, <span class="st">"time_at_diagnosis"</span><span class="op">]</span><span class="op">)</span> <span class="op">-</span></span>
<span>      <span class="va">last_GOLD_transition_time_diagnosed</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#----------------------------UNDIAGNOSED ------------------------------------</span></span>
<span><span class="co">#-------------------------------------------------------------------------</span></span>
<span></span>
<span><span class="va">all_events_undiagnosed</span>          <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">all_events</span>, <span class="va">diagnosis</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">gold</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">gold</span> <span class="op">&lt;</span> <span class="fl">3</span><span class="op">)</span> <span class="co">#CanCOLD is only GOLD 1 and 2</span></span>
<span><span class="va">exac_events_undiagnosed</span>         <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">all_events_undiagnosed</span>, <span class="va">event</span> <span class="op">==</span> <span class="va">EVENT_EXACERBATION</span> <span class="op">)</span></span>
<span><span class="va">sev_exac_events_undiagnosed</span>     <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">all_events_undiagnosed</span>, <span class="va">event</span> <span class="op">==</span> <span class="va">EVENT_EXACERBATION</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">exac_status</span> <span class="op">==</span> <span class="fl">3</span> <span class="op">|</span> <span class="va">exac_status</span> <span class="op">==</span> <span class="fl">4</span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="va">mod_sev_exac_events_undiagnosed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">all_events_undiagnosed</span>, <span class="va">event</span> <span class="op">==</span> <span class="va">EVENT_EXACERBATION</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">exac_status</span> <span class="op">==</span> <span class="fl">3</span> <span class="op">|</span> <span class="va">exac_status</span> <span class="op">==</span> <span class="fl">4</span> <span class="op">|</span> <span class="va">exac_status</span> <span class="op">==</span> <span class="fl">2</span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="va">exit_events_undiagnosed</span>         <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">all_events_undiagnosed</span>, <span class="va">event</span> <span class="op">==</span> <span class="va">EVENT_END</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Follow_up_GOLD_undiagnosed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">last_GOLD_transition_time_undiagnosed</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">all_events_undiagnosed</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">(</span><span class="va">all_events_undiagnosed</span><span class="op">[</span><span class="va">i</span>, <span class="st">"id"</span><span class="op">]</span> <span class="op">!=</span> <span class="va">all_events_undiagnosed</span><span class="op">[</span><span class="va">i</span> <span class="op">-</span> <span class="fl">1</span>, <span class="st">"id"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">last_GOLD_transition_time_undiagnosed</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">(</span><span class="va">all_events_undiagnosed</span><span class="op">[</span><span class="va">i</span>, <span class="st">"id"</span><span class="op">]</span> <span class="op">==</span> <span class="va">all_events_undiagnosed</span><span class="op">[</span><span class="va">i</span> <span class="op">-</span> <span class="fl">1</span>, <span class="st">"id"</span><span class="op">]</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">all_events_undiagnosed</span><span class="op">[</span><span class="va">i</span>, <span class="st">"gold"</span><span class="op">]</span> <span class="op">!=</span> <span class="va">all_events_undiagnosed</span><span class="op">[</span><span class="va">i</span> <span class="op">-</span> <span class="fl">1</span>, <span class="st">"gold"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">Follow_up_GOLD_undiagnosed</span><span class="op">[</span><span class="va">all_events_undiagnosed</span><span class="op">[</span><span class="va">i</span> <span class="op">-</span> <span class="fl">1</span>, <span class="st">"gold"</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="va">Follow_up_GOLD_undiagnosed</span><span class="op">[</span><span class="va">all_events_undiagnosed</span><span class="op">[</span><span class="va">i</span> <span class="op">-</span> <span class="fl">1</span>, <span class="st">"gold"</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span> <span class="op">(</span><span class="va">all_events_undiagnosed</span><span class="op">[</span><span class="va">i</span> <span class="op">-</span> <span class="fl">1</span>, <span class="st">"local_time"</span><span class="op">]</span><span class="op">-</span><span class="va">all_events_undiagnosed</span><span class="op">[</span><span class="va">i</span> <span class="op">-</span> <span class="fl">1</span>, <span class="st">"time_at_diagnosis"</span><span class="op">]</span><span class="op">)</span> <span class="op">-</span></span>
<span>      <span class="va">last_GOLD_transition_time_undiagnosed</span></span>
<span>    <span class="va">last_GOLD_transition_time_undiagnosed</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">all_events_undiagnosed</span><span class="op">[</span><span class="va">i</span> <span class="op">-</span> <span class="fl">1</span>, <span class="st">"local_time"</span><span class="op">]</span><span class="op">-</span><span class="va">all_events_undiagnosed</span><span class="op">[</span><span class="va">i</span> <span class="op">-</span> <span class="fl">1</span>, <span class="st">"time_at_diagnosis"</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">all_events_undiagnosed</span><span class="op">[</span><span class="va">i</span>, <span class="st">"event"</span><span class="op">]</span> <span class="op">==</span> <span class="va">EVENT_END</span><span class="op">)</span></span>
<span>    <span class="va">Follow_up_GOLD_undiagnosed</span><span class="op">[</span><span class="va">all_events_undiagnosed</span><span class="op">[</span><span class="va">i</span>, <span class="st">"gold"</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="va">Follow_up_GOLD_undiagnosed</span><span class="op">[</span><span class="va">all_events_undiagnosed</span><span class="op">[</span><span class="va">i</span>, <span class="st">"gold"</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span> <span class="op">(</span><span class="va">all_events_undiagnosed</span><span class="op">[</span><span class="va">i</span>, <span class="st">"local_time"</span><span class="op">]</span><span class="op">-</span><span class="va">all_events_undiagnosed</span><span class="op">[</span><span class="va">i</span>, <span class="st">"time_at_diagnosis"</span><span class="op">]</span><span class="op">)</span> <span class="op">-</span></span>
<span>      <span class="va">last_GOLD_transition_time_undiagnosed</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#----------------------------All ------------------------------------</span></span>
<span><span class="co">#-------------------------------------------------------------------------</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Exacerbation Rates per GOLD stages for all patients:"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">GOLD_I</span>   <span class="op">&lt;-</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">exac_events</span><span class="op">[</span>, <span class="st">"gold"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">]</span><span class="op">/</span><span class="va">Follow_up_GOLD</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">GOLD_II</span>  <span class="op">&lt;-</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">exac_events</span><span class="op">[</span>, <span class="st">"gold"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">]</span><span class="op">/</span><span class="va">Follow_up_GOLD</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">GOLD_III</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">exac_events</span><span class="op">[</span>, <span class="st">"gold"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span>, <span class="fl">2</span><span class="op">]</span><span class="op">/</span><span class="va">Follow_up_GOLD</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">GOLD_IV</span>  <span class="op">&lt;-</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">exac_events</span><span class="op">[</span>, <span class="st">"gold"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">4</span>, <span class="fl">2</span><span class="op">]</span><span class="op">/</span><span class="va">Follow_up_GOLD</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"exacRateGOLDI   = "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">GOLD_I</span>  , <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"exacRateGOLDII  = "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">GOLD_II</span> , <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"exacRateGOLDIII = "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">GOLD_III</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"exacRateGOLDIV  = "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">GOLD_IV</span> , <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">#----------------------------All ------------------------------------</span></span>
<span><span class="co">#-------------------------------------------------------------------------</span></span>
<span><span class="va">total_rate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">exac_events</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">Follow_up_GOLD</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">Exac_per_GOLD</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span> <span class="op">(</span><span class="cn">NA</span>, nrow <span class="op">=</span> <span class="fl">3</span>, ncol <span class="op">=</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">Exac_per_GOLD</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"GOLD"</span>, <span class="st">"EPIC"</span>, <span class="st">"CanCOLD"</span><span class="op">)</span></span>
<span><span class="co"># CanCOLD only available for GOLD 1 and 2. See doi: 10.1164/rccm.201509-1795OC</span></span>
<span></span>
<span><span class="va">Follow_up_GOLD_all_2level</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">Follow_up_GOLD</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">Follow_up_GOLD</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="co"># Because CanCOLD is mostly GOLD2, here we compare EPIC's GOLD2 only instead of GOLD2+</span></span>
<span><span class="co">#  Follow_up_GOLD_all_2level &lt;- c(Follow_up_GOLD[1], sum(Follow_up_GOLD[2:4]))</span></span>
<span><span class="va">GOLD_counts_all</span>       <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">exac_events</span><span class="op">[</span>, <span class="st">"gold"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">GOLD_counts_all</span>       <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">GOLD_counts_all</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">GOLD_counts_all</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Exac_per_GOLD</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"total"</span>, <span class="st">"gold1"</span>, <span class="st">"gold2+"</span><span class="op">)</span></span>
<span><span class="va">Exac_per_GOLD</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">total_rate</span>,</span>
<span>                           <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">GOLD_counts_all</span><span class="op">/</span><span class="va">Follow_up_GOLD_all_2level</span>,</span>
<span>                                 digit <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Exac_per_GOLD</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.39</span>, <span class="fl">0.28</span>, <span class="fl">0.53</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">Exac_per_GOLD</span><span class="op">)</span></span>
<span><span class="va">dfm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">melt</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"GOLD"</span>, <span class="st">"EPIC"</span>, <span class="st">"CanCOLD"</span><span class="op">)</span><span class="op">]</span>,id.vars <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">plot</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">dfm</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">GOLD</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">3</span>, by <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="http://jrnold.github.io/ggthemes/reference/theme_tufte.html" class="external-link">theme_tufte</a></span><span class="op">(</span>base_size<span class="op">=</span><span class="fl">14</span>, ticks<span class="op">=</span><span class="cn">F</span><span class="op">)</span>  <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">variable</span><span class="op">)</span>, stat <span class="op">=</span> <span class="st">"identity"</span>, position <span class="op">=</span> <span class="st">"dodge"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span> <span class="op">(</span><span class="st">"Rate"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>caption <span class="op">=</span> <span class="st">"Total rate of exacerbations per year for all patients"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">plot</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#--------------------------- total number of severe exacerbations:</span></span>
<span></span>
<span><span class="va">n_exac</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>year<span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">20</span>,Severe_Exacerbations <span class="op">=</span> <span class="op">(</span><span class="va">output_ex</span><span class="op">$</span><span class="va">n_exac_by_ctime_severity</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span><span class="op">+</span><span class="va">output_ex</span><span class="op">$</span><span class="va">n_exac_by_ctime_severity</span><span class="op">[</span>,<span class="fl">4</span><span class="op">]</span><span class="op">)</span><span class="op">*</span> <span class="op">(</span><span class="fl">100000</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">output_ex</span><span class="op">$</span><span class="va">n_alive_by_ctime_sex</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">avgRate_sevExac</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">n_exac</span><span class="op">$</span><span class="va">Severe_Exacerbations</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">n_exac</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span>,<span class="fl">0</span><span class="op">)</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">n_exac</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">avgRate_sevExac</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">avgRate_sevExac</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Average rate during 20 years: "</span>, <span class="va">avgRate_sevExac</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rate2017_sevExac</span> <span class="op">&lt;-</span><span class="op">(</span><span class="va">output_ex</span><span class="op">$</span><span class="va">n_exac_by_ctime_severity</span><span class="op">[</span><span class="fl">3</span>,<span class="fl">3</span><span class="op">]</span><span class="op">+</span><span class="va">output_ex</span><span class="op">$</span><span class="va">n_exac_by_ctime_severity</span><span class="op">[</span><span class="fl">3</span>,<span class="fl">4</span><span class="op">]</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="fl">100000</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">output_ex</span><span class="op">$</span><span class="va">n_alive_by_ctime_sex</span><span class="op">[</span><span class="fl">3</span>,<span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">rate2017_sevExac</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">rate2017_sevExac</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Rate in 2017: "</span>, <span class="va">rate2017_sevExac</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">#----------------------------Diagnosed ------------------------------------</span></span>
<span><span class="co">#-------------------------------------------------------------------------</span></span>
<span></span>
<span><span class="va">Exac_per_GOLD_diagnosed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span> <span class="op">(</span><span class="cn">NA</span>, nrow <span class="op">=</span> <span class="fl">4</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">Exac_per_GOLD_diagnosed</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"GOLD"</span>, <span class="st">"EPIC"</span>, <span class="st">"Hoogendoorn"</span><span class="op">)</span></span>
<span><span class="co"># ACCEPT data is rates from a join of ECLIPSE, MACRO, OPTIMAL and STATCOPE.</span></span>
<span><span class="va">Exac_per_GOLD_diagnosed</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"gold1"</span>, <span class="st">"gold2"</span>, <span class="st">"gold3"</span>, <span class="st">"gold4"</span><span class="op">)</span></span>
<span><span class="va">Exac_per_GOLD_diagnosed</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span></span>
<span>  x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">exac_events_diagnosed</span><span class="op">[</span>, <span class="st">"gold"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span><span class="op">/</span></span>
<span>    <span class="va">Follow_up_GOLD_diagnosed</span>, digit <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">Exac_per_GOLD_diagnosed</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.82</span>, <span class="fl">1.17</span>, <span class="fl">1.61</span>, <span class="fl">2.10</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">Exac_per_GOLD_diagnosed</span><span class="op">)</span></span>
<span><span class="va">dfm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">melt</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"GOLD"</span>, <span class="st">"EPIC"</span>, <span class="st">"Hoogendoorn"</span><span class="op">)</span><span class="op">]</span>,id.vars <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">dfm</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">GOLD</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">3</span>, by <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="http://jrnold.github.io/ggthemes/reference/theme_tufte.html" class="external-link">theme_tufte</a></span><span class="op">(</span>base_size<span class="op">=</span><span class="fl">14</span>, ticks<span class="op">=</span><span class="cn">F</span><span class="op">)</span>  <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">variable</span><span class="op">)</span>, stat <span class="op">=</span> <span class="st">"identity"</span>, position <span class="op">=</span> <span class="st">"dodge"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span> <span class="op">(</span><span class="st">"Rate"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>caption <span class="op">=</span> <span class="st">"Total rate of exacerbations per year for diagnosed patients"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">plot</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Total rate of exacerbation in diagnosed patients (1.5 per year in Hoogendoorn): "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">exac_events_diagnosed</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">Follow_up_GOLD_diagnosed</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">#----------------------------Diagnosed Moderate and Severe------------------------------------</span></span>
<span><span class="co">#-------------------------------------------------------------------------</span></span>
<span></span>
<span><span class="va">Exac_per_GOLD_diagnosed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span> <span class="op">(</span><span class="cn">NA</span>, nrow <span class="op">=</span> <span class="fl">4</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">Exac_per_GOLD_diagnosed</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"GOLD"</span>, <span class="st">"EPIC"</span>, <span class="st">"Wallace 2019"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Exac_per_GOLD_diagnosed</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"gold1"</span>, <span class="st">"gold2"</span>, <span class="st">"gold3"</span>, <span class="st">"gold4"</span><span class="op">)</span></span>
<span><span class="va">Exac_per_GOLD_diagnosed</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span></span>
<span>  x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">mod_sev_exac_events_diagnosed</span><span class="op">[</span>, <span class="st">"gold"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span><span class="op">/</span></span>
<span>    <span class="va">Follow_up_GOLD_diagnosed</span>, digit <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">Exac_per_GOLD_diagnosed</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.404</span>, <span class="fl">0.489</span>, <span class="fl">0.836</span>, <span class="fl">0.891</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">Exac_per_GOLD_diagnosed</span><span class="op">)</span></span>
<span><span class="va">dfm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">melt</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"GOLD"</span>, <span class="st">"EPIC"</span>, <span class="st">"Wallace 2019"</span><span class="op">)</span><span class="op">]</span>,id.vars <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">plot</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">dfm</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">GOLD</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">3</span>, by <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="http://jrnold.github.io/ggthemes/reference/theme_tufte.html" class="external-link">theme_tufte</a></span><span class="op">(</span>base_size<span class="op">=</span><span class="fl">14</span>, ticks<span class="op">=</span><span class="cn">F</span><span class="op">)</span>  <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">variable</span><span class="op">)</span>, stat <span class="op">=</span> <span class="st">"identity"</span>, position <span class="op">=</span> <span class="st">"dodge"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span> <span class="op">(</span><span class="st">"Rate"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>caption <span class="op">=</span> <span class="st">"Total rate of moderate/severe exacerbations per year for diagnosed patients"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">plot</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">#----------------------------Diagnosed Severe------------------------------------</span></span>
<span><span class="co">#-------------------------------------------------------------------------</span></span>
<span></span>
<span><span class="va">Exac_per_GOLD_diagnosed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span> <span class="op">(</span><span class="cn">NA</span>, nrow <span class="op">=</span> <span class="fl">4</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">Exac_per_GOLD_diagnosed</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"GOLD"</span>, <span class="st">"EPIC"</span>, <span class="st">"Wallace 2019"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Exac_per_GOLD_diagnosed</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"gold1"</span>, <span class="st">"gold2"</span>, <span class="st">"gold3"</span>, <span class="st">"gold4"</span><span class="op">)</span></span>
<span><span class="va">Exac_per_GOLD_diagnosed</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span></span>
<span>  x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">sev_exac_events_diagnosed</span><span class="op">[</span>, <span class="st">"gold"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span><span class="op">/</span></span>
<span>    <span class="va">Follow_up_GOLD_diagnosed</span>, digit <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">Exac_per_GOLD_diagnosed</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.12</span>, <span class="fl">0.139</span>, <span class="fl">0.254</span>, <span class="fl">0.422</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">Exac_per_GOLD_diagnosed</span><span class="op">)</span></span>
<span><span class="va">dfm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">melt</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"GOLD"</span>, <span class="st">"EPIC"</span>, <span class="st">"Wallace 2019"</span><span class="op">)</span><span class="op">]</span>,id.vars <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">plot</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">dfm</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">GOLD</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">3</span>, by <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="http://jrnold.github.io/ggthemes/reference/theme_tufte.html" class="external-link">theme_tufte</a></span><span class="op">(</span>base_size<span class="op">=</span><span class="fl">14</span>, ticks<span class="op">=</span><span class="cn">F</span><span class="op">)</span>  <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">variable</span><span class="op">)</span>, stat <span class="op">=</span> <span class="st">"identity"</span>, position <span class="op">=</span> <span class="st">"dodge"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span> <span class="op">(</span><span class="st">"Rate"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>caption <span class="op">=</span> <span class="st">"Total rate of severe exacerbations per year for diagnosed patients"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">plot</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#----------------------------Undiagnosed ------------------------------------</span></span>
<span><span class="co">#----------------------------------------------------------------------------</span></span>
<span><span class="va">total_rate_undiagnosed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">exac_events_undiagnosed</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">Follow_up_GOLD_undiagnosed</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">Exac_per_GOLD_undiagnosed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span> <span class="op">(</span><span class="cn">NA</span>, nrow <span class="op">=</span> <span class="fl">3</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">Exac_per_GOLD_undiagnosed</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"GOLD"</span>, <span class="st">"EPIC"</span>, <span class="st">"CanCOLD"</span><span class="op">)</span></span>
<span><span class="va">Exac_per_GOLD_undiagnosed</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"total"</span>, <span class="st">"gold1"</span>, <span class="st">"gold2+"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Follow_up_GOLD_undiagnosed_2level</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">Follow_up_GOLD_undiagnosed</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>                                       <span class="va">Follow_up_GOLD_undiagnosed</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="co">#Because CANCold is mostly GOLD2, we comprare to GOLD2 EPIC</span></span>
<span><span class="co">#Follow_up_GOLD_undiagnosed_2level &lt;- c(Follow_up_GOLD_undiagnosed[1], sum(Follow_up_GOLD_undiagnosed[2:4]))</span></span>
<span><span class="va">GOLD_counts_undiagnosed</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">exac_events_undiagnosed</span><span class="op">[</span>, <span class="st">"gold"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">GOLD_counts_undiagnosed</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">GOLD_counts_undiagnosed</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>                               <span class="va">GOLD_counts_undiagnosed</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">Exac_per_GOLD_undiagnosed</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">total_rate_undiagnosed</span>,</span>
<span>                                       <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">GOLD_counts_undiagnosed</span><span class="op">/</span><span class="va">Follow_up_GOLD_undiagnosed_2level</span>, digit <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Exac_per_GOLD_undiagnosed</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.30</span>, <span class="fl">0.24</span>, <span class="fl">0.40</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">Exac_per_GOLD_undiagnosed</span><span class="op">)</span></span>
<span><span class="va">dfm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">melt</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"GOLD"</span>, <span class="st">"EPIC"</span>, <span class="st">"CanCOLD"</span><span class="op">)</span><span class="op">]</span>,id.vars <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">plot</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">dfm</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">GOLD</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">3</span>, by <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="http://jrnold.github.io/ggthemes/reference/theme_tufte.html" class="external-link">theme_tufte</a></span><span class="op">(</span>base_size<span class="op">=</span><span class="fl">14</span>, ticks<span class="op">=</span><span class="cn">F</span><span class="op">)</span>  <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">variable</span><span class="op">)</span>, stat <span class="op">=</span> <span class="st">"identity"</span>, position <span class="op">=</span> <span class="st">"dodge"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span> <span class="op">(</span><span class="st">"Rate"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>caption <span class="op">=</span> <span class="st">"Total rate of exacerbations per year for undiagnosed patients"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">plot</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Total rate of exacerbation in undiagnosed patients (0.30 per year in CanCOLD): "</span>,</span>
<span>        <span class="va">total_rate_undiagnosed</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Mohsen Sadatsafavi, Amin Adibi, Kate Johnson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
