# Claude Code Instructions for epicR

This file contains instructions for AI assistants (like Claude) working
on the epicR package.

## When to Run devtools::document()

**You MUST run `devtools::document()` after:**

1.  **Modifying R functions** in the `R/` directory, especially when:
    - Adding new exported functions (with `@export`)
    - Changing function parameters
    - Updating roxygen documentation (`#'` comments)
    - Adding or removing functions
2.  **Modifying C++ functions** in the `src/` directory when:
    - Adding, removing, or changing C++ functions with
      `// [[Rcpp::export]]`
    - This regenerates `src/RcppExports.cpp` and `R/RcppExports.R`
3.  **Changing package-level documentation** (e.g., in `R/epicR.R`)

**Run it like this:**

``` r
devtools::document()
```

**What it does:** - Regenerates `man/*.Rd` documentation files from
roxygen comments - Updates the `NAMESPACE` file with exports -
Regenerates Rcpp exports if C++ files changed - Ensures the package
documentation is in sync with the code

**Rule of thumb**: When in doubt, run `devtools::document()` - it’s safe
and fast!

## After Making Changes

Always test that the package can be: 1. **Documented**:
`devtools::document()` 2. **Loaded**: `devtools::load_all()` 3.
**Checked**: `devtools::check()` (if time permits)

## Common Workflows

### Adding a New Function

1.  Write the function in appropriate R file in `R/`

2.  Add roxygen documentation above it:

    ``` r
    #' Brief description
    #'
    #' Longer description
    #'
    #' @param param1 description
    #' @return what it returns
    #' @export
    #' @examples
    #' \dontrun{
    #' example_code()
    #' }
    function_name <- function(param1) {
      # implementation
    }
    ```

3.  Run `devtools::document()`

4.  Test with `devtools::load_all()`

### Modifying Function Signatures

1.  Update the function parameters
2.  Update the `@param` documentation
3.  Run `devtools::document()`
4.  Check that all examples still work

### Modifying C/C++ Code

When changing files in `src/`: 1. Make your changes 2. If you modified
C++ functions that are exported to R (via Rcpp): - Run
`devtools::document()` to update RcppExports 3. Run
`devtools::load_all()` (recompiles automatically) 4. Test thoroughly 5.
Run `devtools::check()` to ensure no compilation warnings

**Important**: Changes to C++ functions with `// [[Rcpp::export]]`
require `devtools::document()` to regenerate `src/RcppExports.cpp` and
`R/RcppExports.R`.

### Updating Vignettes

After modifying `.Rmd` files in `vignettes/`: 1. Knit the vignette to
test: `rmarkdown::render("vignettes/filename.Rmd")` 2. Build vignettes:
`devtools::build_vignettes()` 3. Check the output HTML looks correct

## Package-Specific Notes

### Configuration Files

The package uses JSON config files in `inst/config/`: -
`config_canada.json` - Canadian parameters - `config_us.json` - US
parameters

Each config must have a `"jurisdiction"` field at the top level.

### Session Management

The package uses [`simulate()`](reference/simulate.md) which handles
sessions automatically, including initialization, running the
simulation, and cleanup.

### Memory Management

The C++ engine allocates memory for simulations. The
[`simulate()`](reference/simulate.md) function handles all memory
management automatically, including cleanup even if errors occur.

### Compilation

The package includes: - C++ code using Rcpp/RcppArmadillo - A
`configure` script that checks for gfortran - Platform-specific
compilation via `Makevars.in`

Don’t modify `src/Makevars` directly - it’s generated by `configure`.

## Testing Checklist

Before committing changes to package functions:

Run `devtools::document()`

Run `devtools::load_all()` successfully

Test the changed functions interactively

Verify no new warnings in `devtools::check()`

Update relevant vignettes if user-facing changes

Update README.md if it affects the Quick Guide

## Git Workflow

1.  Make changes
2.  Run `devtools::document()` if needed
3.  Test changes
4.  Stage files: `git add <files>`
5.  Commit with descriptive message
6.  Push to GitHub

## Common Issues

### “object not found” after adding function

- Forgot to run `devtools::document()`
- Missing `@export` tag

### NAMESPACE conflicts

- Run `devtools::document()` to regenerate
- Check for duplicate `@export` tags

### Vignette won’t build

- Check that all R code chunks have `eval=FALSE` for examples that need
  sessions
- Ensure package dependencies are in `DESCRIPTION`

## Resources

- [R Packages Book](https://r-pkgs.org/)
- [roxygen2 documentation](https://roxygen2.r-lib.org/)
- [Rcpp documentation](https://www.rcpp.org/)
