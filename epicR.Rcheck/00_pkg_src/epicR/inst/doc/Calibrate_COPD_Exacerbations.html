<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Calibrate COPD Exacerbations</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Calibrate COPD Exacerbations</h1>



<div id="overview" class="section level3">
<h3>Overview</h3>
<p>This document outlines the calibration process undertaken to align
the model’s outputs with validation targets for COPD exacerbations,
using the ACCEPT study, Hoogendorn et al 2021, and CanCOLD.</p>
</div>
<div id="calibration-of-copd-exacerbation-rates" class="section level2">
<h2>Calibration of COPD Exacerbation Rates</h2>
<p>This section outlines the internal validation process conducted to
align the model’s simulated COPD exacerbation rates with empirical
targets drawn from key reference studies. The validation focused on both
diagnosed and undiagnosed populations and was stratified by GOLD stage
and exacerbation severity (total, moderate/severe, and severe only).
Detailed validation targets and associated calibration code are
presented below.</p>
<p><strong>Validation References:</strong></p>
<ul>
<li>Ford et al. 2015 (DOI: 10.1378/chest.14-2146)</li>
<li>Hoogendoorn et al. 2021 (DOI: 10.1183/09031936.00043710)</li>
<li>Wallace et al. 2019 (DOI: 10.18553/jmcp.2019.25.2.205)</li>
<li>CanCOLD study (DOI: 10.3109/15412555.2012.665520)</li>
</ul>
<hr />
<div id="validation-targets" class="section level3">
<h3><strong>Validation Targets</strong></h3>
<div id="total-rate-of-exacerbation-per-100000-individuals-ford-et-al.-2015" class="section level4">
<h4><strong>Total Rate of Exacerbation per 100,000 individuals (Ford et
al. 2015)</strong></h4>
<p>Ford et al. 2015 reported age-specific hospitalization rates for COPD
but did not provide an aggregated rate for adults aged &gt;40 years. As
such this estimate was not available, a combined rate was derived as the
best available evidence for a population-level measure of COPD-related
hospitalizations per 100,000 individuals in this age group.</p>
<p>To calculate this estimate, age-specific hospitalization rates
reported in Table 1 of Ford et al. 2015 and were weighted by the U.S.
Census population counts for 2012. Rates reported in Table 1 per 100,000
were 276.9 for ages 45–64, 939.4 for ages 65–84, and 1,181.2 for ages
≥85. Each rate was multiplied by the corresponding population size from
the U.S. Census population numbers for 2012 (81.5 million, 35.0 million,
and 5.9 million, respectively) to obtain the expected number of
hospitalizations within each strata. These values were summed and
divided by the total population aged &gt;40 years (122.4 million), then
scaled per 100,000. The resulting combined hospitalization rate was
approximately 510 per 100,000 individuals aged &gt;40 years in 2012.</p>
<ul>
<li><strong>Total Exacerbation Rate:</strong> 510 per 100,000
individuals</li>
</ul>
</div>
<div id="diagnosed-patients-total-exacerbation-rate-hoogendoorn-et-al.-2021" class="section level4">
<h4><strong>Diagnosed Patients – Total Exacerbation Rate (Hoogendoorn et
al. 2021)</strong></h4>
<p>Simulated rates were compared against those reported by Hoogendoorn
et al. 2021: - <strong>GOLD 1:</strong> 0.82<br />
- <strong>GOLD 2:</strong> 1.17<br />
- <strong>GOLD 3:</strong> 1.61<br />
- <strong>GOLD 4:</strong> 2.10</p>
</div>
<div id="diagnosed-patients-moderate-and-severe-exacerbation-rates-wallace-et-al.-2019-study" class="section level4">
<h4><strong>Diagnosed Patients – Moderate and Severe Exacerbation Rates
(Wallace et al. 2019 Study)</strong></h4>
<p>Wallace et al. 2019 provided target rates for moderate and severe
exacerbations: - <strong>GOLD 1:</strong> 0.404 - <strong>GOLD
2:</strong> 0.489<br />
- <strong>GOLD 3:</strong> 0.836 - <strong>GOLD 4:</strong> 0.891</p>
</div>
<div id="diagnosed-patients-severe-exacerbation-rates-wallace-et-al.-2019-study" class="section level4">
<h4><strong>Diagnosed Patients – Severe Exacerbation Rates</strong>
(Wallace et al. 2019 Study)</h4>
<p>Wallace et al. 2019 provided target rates for severe exacerbations: -
<strong>GOLD 1:</strong> 0.12 - <strong>GOLD 2:</strong> 0.139<br />
- <strong>GOLD 3:</strong> 0.254<br />
- <strong>GOLD 4:</strong> 0.422</p>
</div>
<div id="undiagnosed-patients-total-exacerbation-rate-cancold" class="section level4">
<h4><strong>Undiagnosed Patients – Total Exacerbation Rate
(CanCOLD)</strong></h4>
<p>For the undiagnosed subgroup, exacerbation rates were benchmarked
against CanCOLD data: - <strong>Total population:</strong> 0.30<br />
- <strong>GOLD 1:</strong> 0.24<br />
- <strong>GOLD 2+:</strong> 0.40</p>
</div>
<div id="overall-and-gold-stratified-total-exacerbation-rates-cancold" class="section level4">
<h4><strong>Overall and GOLD-Stratified Total Exacerbation Rates
(CanCOLD)</strong></h4>
<p>For all individuals (diagnosed and undiagnosed), total exacerbation
rates per year were compared against the CanCOLD study benchmarks: -
<strong>Total population:</strong> 0.39<br />
- <strong>GOLD 1:</strong> 0.28<br />
- <strong>GOLD 2+:</strong> 0.53</p>
<hr />
<p>The calibration code below performs the relevant calculations and
visualizations for each validation target.</p>
</div>
</div>
<div id="step-1-load-libraries-and-setup" class="section level3">
<h3>Step 1: Load libraries and setup</h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(epicR)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">library</span>(ggthemes)</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="fu">library</span>(reshape2)</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="co"># Define event codes</span></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a>EVENT_EXACERBATION <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a>EVENT_END <span class="ot">&lt;-</span> <span class="dv">11</span>  <span class="co"># Updated event_end code after MI/stroke/HF removal</span></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a><span class="co"># Load EPIC general settings</span></span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a>settings <span class="ot">&lt;-</span> <span class="fu">get_default_settings</span>()</span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a>settings<span class="sc">$</span>record_mode <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a>settings<span class="sc">$</span>n_base_agents <span class="ot">&lt;-</span> <span class="fl">3.5e6</span></span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a><span class="fu">init_session</span>(<span class="at">settings =</span> settings)</span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a><span class="co"># Load input with US config (change to &quot;canada&quot; for Canadian parameters)</span></span>
<span id="cb1-21"><a href="#cb1-21" tabindex="-1"></a>input <span class="ot">&lt;-</span> <span class="fu">get_input</span>(<span class="at">jurisdiction =</span> <span class="st">&quot;us&quot;</span>)</span>
<span id="cb1-22"><a href="#cb1-22" tabindex="-1"></a>time_horizon <span class="ot">&lt;-</span> <span class="dv">26</span></span>
<span id="cb1-23"><a href="#cb1-23" tabindex="-1"></a></span>
<span id="cb1-24"><a href="#cb1-24" tabindex="-1"></a><span class="co"># Modify intercept value to calibrate proportion of COPD exacerbations</span></span>
<span id="cb1-25"><a href="#cb1-25" tabindex="-1"></a>input<span class="sc">$</span>values<span class="sc">$</span>exacerbation<span class="sc">$</span>ln_rate_betas <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(<span class="fu">c</span>(<span class="at">intercept =</span> <span class="fl">1.8</span>, <span class="at">female =</span> <span class="dv">0</span>, <span class="at">age =</span> <span class="fl">0.04082</span> <span class="sc">*</span> <span class="fl">0.1</span>, <span class="at">fev1 =</span> <span class="sc">-</span><span class="fl">1.5</span>, <span class="at">smoking_status =</span> <span class="fl">0.7</span>, <span class="at">gold1 =</span> <span class="fl">0.15</span> , <span class="at">gold2 =</span> <span class="sc">-</span><span class="fl">0.10</span> , <span class="at">gold3 =</span> <span class="sc">-</span><span class="fl">0.40</span> , <span class="at">gold4 =</span> <span class="sc">-</span><span class="fl">0.75</span> , <span class="at">diagnosis_effect =</span> <span class="dv">0</span>)))</span>
<span id="cb1-26"><a href="#cb1-26" tabindex="-1"></a>input<span class="sc">$</span>values<span class="sc">$</span>exacerbation<span class="sc">$</span>logit_severity_betas <span class="ot">=</span> <span class="fu">t</span>(<span class="fu">as.matrix</span>(<span class="fu">c</span>(<span class="at">intercept1 =</span> <span class="sc">-</span><span class="fl">0.309</span>, <span class="at">intercept2 =</span> <span class="fl">2.502</span>, <span class="at">intercept3 =</span> <span class="fl">5.508</span>, <span class="at">female =</span> <span class="sc">-</span><span class="fl">0.764</span>, <span class="at">age =</span> <span class="sc">-</span><span class="fl">0.007</span>, <span class="at">fev1 =</span> <span class="fl">0.98</span>, <span class="at">smoking_status =</span> <span class="fl">0.348</span>, <span class="at">pack_years =</span> <span class="sc">-</span><span class="fl">0.001</span> , <span class="at">BMI =</span> <span class="fl">0.018</span>)))</span>
<span id="cb1-27"><a href="#cb1-27" tabindex="-1"></a></span>
<span id="cb1-28"><a href="#cb1-28" tabindex="-1"></a><span class="co"># Run the model</span></span>
<span id="cb1-29"><a href="#cb1-29" tabindex="-1"></a><span class="fu">run</span>(<span class="at">input =</span> input<span class="sc">$</span>values)</span>
<span id="cb1-30"><a href="#cb1-30" tabindex="-1"></a>op <span class="ot">&lt;-</span> <span class="fu">Cget_output</span>()</span>
<span id="cb1-31"><a href="#cb1-31" tabindex="-1"></a>output_ex <span class="ot">&lt;-</span> <span class="fu">Cget_output_ex</span>()</span>
<span id="cb1-32"><a href="#cb1-32" tabindex="-1"></a></span>
<span id="cb1-33"><a href="#cb1-33" tabindex="-1"></a>all_events <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">Cget_all_events_matrix</span>())</span>
<span id="cb1-34"><a href="#cb1-34" tabindex="-1"></a>exac_events <span class="ot">&lt;-</span> <span class="fu">subset</span>(all_events, event <span class="sc">==</span> EVENT_EXACERBATION)</span>
<span id="cb1-35"><a href="#cb1-35" tabindex="-1"></a>exit_events <span class="ot">&lt;-</span> <span class="fu">subset</span>(all_events, event <span class="sc">==</span> EVENT_END)</span>
<span id="cb1-36"><a href="#cb1-36" tabindex="-1"></a></span>
<span id="cb1-37"><a href="#cb1-37" tabindex="-1"></a>Follow_up_GOLD <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb1-38"><a href="#cb1-38" tabindex="-1"></a>last_GOLD_transition_time <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb1-39"><a href="#cb1-39" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">dim</span>(all_events)[<span class="dv">1</span>]) {</span>
<span id="cb1-40"><a href="#cb1-40" tabindex="-1"></a>  <span class="cf">if</span> (all_events[i, <span class="st">&quot;id&quot;</span>] <span class="sc">!=</span> all_events[i <span class="sc">-</span> <span class="dv">1</span>, <span class="st">&quot;id&quot;</span>])</span>
<span id="cb1-41"><a href="#cb1-41" tabindex="-1"></a>    last_GOLD_transition_time <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb1-42"><a href="#cb1-42" tabindex="-1"></a>  <span class="cf">if</span> ((all_events[i, <span class="st">&quot;id&quot;</span>] <span class="sc">==</span> all_events[i <span class="sc">-</span> <span class="dv">1</span>, <span class="st">&quot;id&quot;</span>]) <span class="sc">&amp;</span> (all_events[i, <span class="st">&quot;gold&quot;</span>] <span class="sc">!=</span> all_events[i <span class="sc">-</span> <span class="dv">1</span>, <span class="st">&quot;gold&quot;</span>])) {</span>
<span id="cb1-43"><a href="#cb1-43" tabindex="-1"></a>    Follow_up_GOLD[all_events[i <span class="sc">-</span> <span class="dv">1</span>, <span class="st">&quot;gold&quot;</span>]] <span class="ot">=</span> Follow_up_GOLD[all_events[i <span class="sc">-</span> <span class="dv">1</span>, <span class="st">&quot;gold&quot;</span>]] <span class="sc">+</span> all_events[i <span class="sc">-</span> <span class="dv">1</span>, <span class="st">&quot;followup_after_COPD&quot;</span>] <span class="sc">-</span></span>
<span id="cb1-44"><a href="#cb1-44" tabindex="-1"></a>      last_GOLD_transition_time</span>
<span id="cb1-45"><a href="#cb1-45" tabindex="-1"></a>    last_GOLD_transition_time <span class="ot">&lt;-</span> all_events[i <span class="sc">-</span> <span class="dv">1</span>, <span class="st">&quot;followup_after_COPD&quot;</span>]</span>
<span id="cb1-46"><a href="#cb1-46" tabindex="-1"></a>  }</span>
<span id="cb1-47"><a href="#cb1-47" tabindex="-1"></a>  <span class="cf">if</span> (all_events[i, <span class="st">&quot;event&quot;</span>] <span class="sc">==</span> EVENT_END)</span>
<span id="cb1-48"><a href="#cb1-48" tabindex="-1"></a>    Follow_up_GOLD[all_events[i, <span class="st">&quot;gold&quot;</span>]] <span class="ot">=</span> Follow_up_GOLD[all_events[i, <span class="st">&quot;gold&quot;</span>]] <span class="sc">+</span> all_events[i, <span class="st">&quot;followup_after_COPD&quot;</span>] <span class="sc">-</span></span>
<span id="cb1-49"><a href="#cb1-49" tabindex="-1"></a>      last_GOLD_transition_time</span>
<span id="cb1-50"><a href="#cb1-50" tabindex="-1"></a>}</span>
<span id="cb1-51"><a href="#cb1-51" tabindex="-1"></a></span>
<span id="cb1-52"><a href="#cb1-52" tabindex="-1"></a></span>
<span id="cb1-53"><a href="#cb1-53" tabindex="-1"></a><span class="co">#----------------------------DIAGNOSED ------------------------------------</span></span>
<span id="cb1-54"><a href="#cb1-54" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------</span></span>
<span id="cb1-55"><a href="#cb1-55" tabindex="-1"></a></span>
<span id="cb1-56"><a href="#cb1-56" tabindex="-1"></a>all_events_diagnosed          <span class="ot">&lt;-</span> <span class="fu">subset</span>(all_events, diagnosis <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> gold <span class="sc">&gt;</span> <span class="dv">0</span> )</span>
<span id="cb1-57"><a href="#cb1-57" tabindex="-1"></a>exac_events_diagnosed         <span class="ot">&lt;-</span> <span class="fu">subset</span>(all_events_diagnosed, event <span class="sc">==</span> EVENT_EXACERBATION )</span>
<span id="cb1-58"><a href="#cb1-58" tabindex="-1"></a>sev_exac_events_diagnosed    <span class="ot">&lt;-</span> <span class="fu">subset</span>(all_events_diagnosed, event <span class="sc">==</span> EVENT_EXACERBATION <span class="sc">&amp;</span> (exac_status <span class="sc">==</span> <span class="dv">3</span> <span class="sc">|</span> exac_status <span class="sc">==</span> <span class="dv">4</span>) )</span>
<span id="cb1-59"><a href="#cb1-59" tabindex="-1"></a>mod_sev_exac_events_diagnosed <span class="ot">&lt;-</span> <span class="fu">subset</span>(all_events_diagnosed, event <span class="sc">==</span> EVENT_EXACERBATION <span class="sc">&amp;</span> (exac_status <span class="sc">==</span> <span class="dv">3</span> <span class="sc">|</span> exac_status <span class="sc">==</span> <span class="dv">4</span> <span class="sc">|</span> exac_status <span class="sc">==</span> <span class="dv">2</span>) )</span>
<span id="cb1-60"><a href="#cb1-60" tabindex="-1"></a>exit_events_diagnosed         <span class="ot">&lt;-</span> <span class="fu">subset</span>(all_events_diagnosed, event <span class="sc">==</span> EVENT_END)</span>
<span id="cb1-61"><a href="#cb1-61" tabindex="-1"></a></span>
<span id="cb1-62"><a href="#cb1-62" tabindex="-1"></a>Follow_up_GOLD_diagnosed <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb1-63"><a href="#cb1-63" tabindex="-1"></a>last_GOLD_transition_time_diagnosed <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb1-64"><a href="#cb1-64" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">dim</span>(all_events_diagnosed)[<span class="dv">1</span>]) {</span>
<span id="cb1-65"><a href="#cb1-65" tabindex="-1"></a>  <span class="cf">if</span> ((all_events_diagnosed[i, <span class="st">&quot;id&quot;</span>] <span class="sc">!=</span> all_events_diagnosed[i <span class="sc">-</span> <span class="dv">1</span>, <span class="st">&quot;id&quot;</span>]))</span>
<span id="cb1-66"><a href="#cb1-66" tabindex="-1"></a>    last_GOLD_transition_time_diagnosed <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb1-67"><a href="#cb1-67" tabindex="-1"></a>  <span class="cf">if</span> ((all_events_diagnosed[i, <span class="st">&quot;id&quot;</span>] <span class="sc">==</span> all_events_diagnosed[i <span class="sc">-</span> <span class="dv">1</span>, <span class="st">&quot;id&quot;</span>]) <span class="sc">&amp;</span> (all_events_diagnosed[i, <span class="st">&quot;gold&quot;</span>] <span class="sc">!=</span> all_events_diagnosed[i <span class="sc">-</span> <span class="dv">1</span>, <span class="st">&quot;gold&quot;</span>])) {</span>
<span id="cb1-68"><a href="#cb1-68" tabindex="-1"></a>    Follow_up_GOLD_diagnosed[all_events_diagnosed[i <span class="sc">-</span> <span class="dv">1</span>, <span class="st">&quot;gold&quot;</span>]] <span class="ot">=</span> Follow_up_GOLD_diagnosed[all_events_diagnosed[i <span class="sc">-</span> <span class="dv">1</span>, <span class="st">&quot;gold&quot;</span>]] <span class="sc">+</span> (all_events_diagnosed[i <span class="sc">-</span> <span class="dv">1</span>, <span class="st">&quot;local_time&quot;</span>]<span class="sc">-</span>all_events_diagnosed[i <span class="sc">-</span> <span class="dv">1</span>, <span class="st">&quot;time_at_diagnosis&quot;</span>]) <span class="sc">-</span></span>
<span id="cb1-69"><a href="#cb1-69" tabindex="-1"></a>      last_GOLD_transition_time_diagnosed</span>
<span id="cb1-70"><a href="#cb1-70" tabindex="-1"></a>    last_GOLD_transition_time_diagnosed <span class="ot">&lt;-</span> (all_events_diagnosed[i <span class="sc">-</span> <span class="dv">1</span>, <span class="st">&quot;local_time&quot;</span>]<span class="sc">-</span>all_events_diagnosed[i <span class="sc">-</span> <span class="dv">1</span>, <span class="st">&quot;time_at_diagnosis&quot;</span>])</span>
<span id="cb1-71"><a href="#cb1-71" tabindex="-1"></a>  }</span>
<span id="cb1-72"><a href="#cb1-72" tabindex="-1"></a>  <span class="cf">if</span> (all_events_diagnosed[i, <span class="st">&quot;event&quot;</span>] <span class="sc">==</span> EVENT_END)</span>
<span id="cb1-73"><a href="#cb1-73" tabindex="-1"></a>    Follow_up_GOLD_diagnosed[all_events_diagnosed[i, <span class="st">&quot;gold&quot;</span>]] <span class="ot">=</span> Follow_up_GOLD_diagnosed[all_events_diagnosed[i, <span class="st">&quot;gold&quot;</span>]] <span class="sc">+</span> (all_events_diagnosed[i, <span class="st">&quot;local_time&quot;</span>]<span class="sc">-</span>all_events_diagnosed[i, <span class="st">&quot;time_at_diagnosis&quot;</span>]) <span class="sc">-</span></span>
<span id="cb1-74"><a href="#cb1-74" tabindex="-1"></a>      last_GOLD_transition_time_diagnosed</span>
<span id="cb1-75"><a href="#cb1-75" tabindex="-1"></a>}</span>
<span id="cb1-76"><a href="#cb1-76" tabindex="-1"></a></span>
<span id="cb1-77"><a href="#cb1-77" tabindex="-1"></a><span class="co">#----------------------------UNDIAGNOSED ------------------------------------</span></span>
<span id="cb1-78"><a href="#cb1-78" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------</span></span>
<span id="cb1-79"><a href="#cb1-79" tabindex="-1"></a></span>
<span id="cb1-80"><a href="#cb1-80" tabindex="-1"></a>all_events_undiagnosed          <span class="ot">&lt;-</span> <span class="fu">subset</span>(all_events, diagnosis <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> gold <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> gold <span class="sc">&lt;</span> <span class="dv">3</span>) <span class="co">#CanCOLD is only GOLD 1 and 2</span></span>
<span id="cb1-81"><a href="#cb1-81" tabindex="-1"></a>exac_events_undiagnosed         <span class="ot">&lt;-</span> <span class="fu">subset</span>(all_events_undiagnosed, event <span class="sc">==</span> EVENT_EXACERBATION )</span>
<span id="cb1-82"><a href="#cb1-82" tabindex="-1"></a>sev_exac_events_undiagnosed     <span class="ot">&lt;-</span> <span class="fu">subset</span>(all_events_undiagnosed, event <span class="sc">==</span> EVENT_EXACERBATION <span class="sc">&amp;</span> (exac_status <span class="sc">==</span> <span class="dv">3</span> <span class="sc">|</span> exac_status <span class="sc">==</span> <span class="dv">4</span>) )</span>
<span id="cb1-83"><a href="#cb1-83" tabindex="-1"></a>mod_sev_exac_events_undiagnosed <span class="ot">&lt;-</span> <span class="fu">subset</span>(all_events_undiagnosed, event <span class="sc">==</span> EVENT_EXACERBATION <span class="sc">&amp;</span> (exac_status <span class="sc">==</span> <span class="dv">3</span> <span class="sc">|</span> exac_status <span class="sc">==</span> <span class="dv">4</span> <span class="sc">|</span> exac_status <span class="sc">==</span> <span class="dv">2</span>) )</span>
<span id="cb1-84"><a href="#cb1-84" tabindex="-1"></a>exit_events_undiagnosed         <span class="ot">&lt;-</span> <span class="fu">subset</span>(all_events_undiagnosed, event <span class="sc">==</span> EVENT_END)</span>
<span id="cb1-85"><a href="#cb1-85" tabindex="-1"></a></span>
<span id="cb1-86"><a href="#cb1-86" tabindex="-1"></a>Follow_up_GOLD_undiagnosed <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb1-87"><a href="#cb1-87" tabindex="-1"></a>last_GOLD_transition_time_undiagnosed <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb1-88"><a href="#cb1-88" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">dim</span>(all_events_undiagnosed)[<span class="dv">1</span>]) {</span>
<span id="cb1-89"><a href="#cb1-89" tabindex="-1"></a>  <span class="cf">if</span> ((all_events_undiagnosed[i, <span class="st">&quot;id&quot;</span>] <span class="sc">!=</span> all_events_undiagnosed[i <span class="sc">-</span> <span class="dv">1</span>, <span class="st">&quot;id&quot;</span>]))</span>
<span id="cb1-90"><a href="#cb1-90" tabindex="-1"></a>    last_GOLD_transition_time_undiagnosed <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb1-91"><a href="#cb1-91" tabindex="-1"></a>  <span class="cf">if</span> ((all_events_undiagnosed[i, <span class="st">&quot;id&quot;</span>] <span class="sc">==</span> all_events_undiagnosed[i <span class="sc">-</span> <span class="dv">1</span>, <span class="st">&quot;id&quot;</span>]) <span class="sc">&amp;</span> (all_events_undiagnosed[i, <span class="st">&quot;gold&quot;</span>] <span class="sc">!=</span> all_events_undiagnosed[i <span class="sc">-</span> <span class="dv">1</span>, <span class="st">&quot;gold&quot;</span>])) {</span>
<span id="cb1-92"><a href="#cb1-92" tabindex="-1"></a>    Follow_up_GOLD_undiagnosed[all_events_undiagnosed[i <span class="sc">-</span> <span class="dv">1</span>, <span class="st">&quot;gold&quot;</span>]] <span class="ot">=</span> Follow_up_GOLD_undiagnosed[all_events_undiagnosed[i <span class="sc">-</span> <span class="dv">1</span>, <span class="st">&quot;gold&quot;</span>]] <span class="sc">+</span> (all_events_undiagnosed[i <span class="sc">-</span> <span class="dv">1</span>, <span class="st">&quot;local_time&quot;</span>]<span class="sc">-</span>all_events_undiagnosed[i <span class="sc">-</span> <span class="dv">1</span>, <span class="st">&quot;time_at_diagnosis&quot;</span>]) <span class="sc">-</span></span>
<span id="cb1-93"><a href="#cb1-93" tabindex="-1"></a>      last_GOLD_transition_time_undiagnosed</span>
<span id="cb1-94"><a href="#cb1-94" tabindex="-1"></a>    last_GOLD_transition_time_undiagnosed <span class="ot">&lt;-</span> (all_events_undiagnosed[i <span class="sc">-</span> <span class="dv">1</span>, <span class="st">&quot;local_time&quot;</span>]<span class="sc">-</span>all_events_undiagnosed[i <span class="sc">-</span> <span class="dv">1</span>, <span class="st">&quot;time_at_diagnosis&quot;</span>])</span>
<span id="cb1-95"><a href="#cb1-95" tabindex="-1"></a>  }</span>
<span id="cb1-96"><a href="#cb1-96" tabindex="-1"></a>  <span class="cf">if</span> (all_events_undiagnosed[i, <span class="st">&quot;event&quot;</span>] <span class="sc">==</span> EVENT_END)</span>
<span id="cb1-97"><a href="#cb1-97" tabindex="-1"></a>    Follow_up_GOLD_undiagnosed[all_events_undiagnosed[i, <span class="st">&quot;gold&quot;</span>]] <span class="ot">=</span> Follow_up_GOLD_undiagnosed[all_events_undiagnosed[i, <span class="st">&quot;gold&quot;</span>]] <span class="sc">+</span> (all_events_undiagnosed[i, <span class="st">&quot;local_time&quot;</span>]<span class="sc">-</span>all_events_undiagnosed[i, <span class="st">&quot;time_at_diagnosis&quot;</span>]) <span class="sc">-</span></span>
<span id="cb1-98"><a href="#cb1-98" tabindex="-1"></a>      last_GOLD_transition_time_undiagnosed</span>
<span id="cb1-99"><a href="#cb1-99" tabindex="-1"></a>}</span>
<span id="cb1-100"><a href="#cb1-100" tabindex="-1"></a></span>
<span id="cb1-101"><a href="#cb1-101" tabindex="-1"></a><span class="fu">terminate_session</span>()</span>
<span id="cb1-102"><a href="#cb1-102" tabindex="-1"></a></span>
<span id="cb1-103"><a href="#cb1-103" tabindex="-1"></a><span class="co">#----------------------------All ------------------------------------</span></span>
<span id="cb1-104"><a href="#cb1-104" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------</span></span>
<span id="cb1-105"><a href="#cb1-105" tabindex="-1"></a></span>
<span id="cb1-106"><a href="#cb1-106" tabindex="-1"></a><span class="fu">message</span>(<span class="st">&quot;Exacerbation Rates per GOLD stages for all patients:&quot;</span>)</span>
<span id="cb1-107"><a href="#cb1-107" tabindex="-1"></a></span>
<span id="cb1-108"><a href="#cb1-108" tabindex="-1"></a>GOLD_I   <span class="ot">&lt;-</span> (<span class="fu">as.data.frame</span>(<span class="fu">table</span>(exac_events[, <span class="st">&quot;gold&quot;</span>]))[<span class="dv">1</span>, <span class="dv">2</span>]<span class="sc">/</span>Follow_up_GOLD[<span class="dv">1</span>])</span>
<span id="cb1-109"><a href="#cb1-109" tabindex="-1"></a>GOLD_II  <span class="ot">&lt;-</span> (<span class="fu">as.data.frame</span>(<span class="fu">table</span>(exac_events[, <span class="st">&quot;gold&quot;</span>]))[<span class="dv">2</span>, <span class="dv">2</span>]<span class="sc">/</span>Follow_up_GOLD[<span class="dv">2</span>])</span>
<span id="cb1-110"><a href="#cb1-110" tabindex="-1"></a>GOLD_III <span class="ot">&lt;-</span> (<span class="fu">as.data.frame</span>(<span class="fu">table</span>(exac_events[, <span class="st">&quot;gold&quot;</span>]))[<span class="dv">3</span>, <span class="dv">2</span>]<span class="sc">/</span>Follow_up_GOLD[<span class="dv">3</span>])</span>
<span id="cb1-111"><a href="#cb1-111" tabindex="-1"></a>GOLD_IV  <span class="ot">&lt;-</span> (<span class="fu">as.data.frame</span>(<span class="fu">table</span>(exac_events[, <span class="st">&quot;gold&quot;</span>]))[<span class="dv">4</span>, <span class="dv">2</span>]<span class="sc">/</span>Follow_up_GOLD[<span class="dv">4</span>])</span>
<span id="cb1-112"><a href="#cb1-112" tabindex="-1"></a></span>
<span id="cb1-113"><a href="#cb1-113" tabindex="-1"></a><span class="fu">message</span>(<span class="fu">paste0</span>(<span class="st">&quot;exacRateGOLDI   = &quot;</span>, <span class="fu">round</span>(GOLD_I  , <span class="dv">2</span>)))</span>
<span id="cb1-114"><a href="#cb1-114" tabindex="-1"></a><span class="fu">message</span>(<span class="fu">paste0</span>(<span class="st">&quot;exacRateGOLDII  = &quot;</span>, <span class="fu">round</span>(GOLD_II , <span class="dv">2</span>)))</span>
<span id="cb1-115"><a href="#cb1-115" tabindex="-1"></a><span class="fu">message</span>(<span class="fu">paste0</span>(<span class="st">&quot;exacRateGOLDIII = &quot;</span>, <span class="fu">round</span>(GOLD_III, <span class="dv">2</span>)))</span>
<span id="cb1-116"><a href="#cb1-116" tabindex="-1"></a><span class="fu">message</span>(<span class="fu">paste0</span>(<span class="st">&quot;exacRateGOLDIV  = &quot;</span>, <span class="fu">round</span>(GOLD_IV , <span class="dv">2</span>)))</span>
<span id="cb1-117"><a href="#cb1-117" tabindex="-1"></a></span>
<span id="cb1-118"><a href="#cb1-118" tabindex="-1"></a></span>
<span id="cb1-119"><a href="#cb1-119" tabindex="-1"></a><span class="co">#----------------------------All ------------------------------------</span></span>
<span id="cb1-120"><a href="#cb1-120" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------</span></span>
<span id="cb1-121"><a href="#cb1-121" tabindex="-1"></a>total_rate <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">nrow</span>(exac_events)<span class="sc">/</span><span class="fu">sum</span>(Follow_up_GOLD), <span class="dv">2</span>)</span>
<span id="cb1-122"><a href="#cb1-122" tabindex="-1"></a>Exac_per_GOLD <span class="ot">&lt;-</span> <span class="fu">matrix</span> (<span class="cn">NA</span>, <span class="at">nrow =</span> <span class="dv">3</span>, <span class="at">ncol =</span><span class="dv">3</span>)</span>
<span id="cb1-123"><a href="#cb1-123" tabindex="-1"></a><span class="fu">colnames</span>(Exac_per_GOLD) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;GOLD&quot;</span>, <span class="st">&quot;EPIC&quot;</span>, <span class="st">&quot;CanCOLD&quot;</span>)</span>
<span id="cb1-124"><a href="#cb1-124" tabindex="-1"></a><span class="co"># CanCOLD only available for GOLD 1 and 2. See doi: 10.1164/rccm.201509-1795OC</span></span>
<span id="cb1-125"><a href="#cb1-125" tabindex="-1"></a></span>
<span id="cb1-126"><a href="#cb1-126" tabindex="-1"></a>Follow_up_GOLD_all_2level <span class="ot">&lt;-</span> <span class="fu">c</span>(Follow_up_GOLD[<span class="dv">1</span>], Follow_up_GOLD[<span class="dv">2</span>]) <span class="co"># Because CanCOLD is mostly GOLD2, here we compare EPIC&#39;s GOLD2 only instead of GOLD2+</span></span>
<span id="cb1-127"><a href="#cb1-127" tabindex="-1"></a><span class="co">#  Follow_up_GOLD_all_2level &lt;- c(Follow_up_GOLD[1], sum(Follow_up_GOLD[2:4]))</span></span>
<span id="cb1-128"><a href="#cb1-128" tabindex="-1"></a>GOLD_counts_all       <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">table</span>(exac_events[, <span class="st">&quot;gold&quot;</span>]))[, <span class="dv">2</span>]</span>
<span id="cb1-129"><a href="#cb1-129" tabindex="-1"></a>GOLD_counts_all       <span class="ot">&lt;-</span> <span class="fu">c</span>(GOLD_counts_all[<span class="dv">1</span>], <span class="fu">sum</span>(GOLD_counts_all[<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>]))</span>
<span id="cb1-130"><a href="#cb1-130" tabindex="-1"></a></span>
<span id="cb1-131"><a href="#cb1-131" tabindex="-1"></a>Exac_per_GOLD[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;total&quot;</span>, <span class="st">&quot;gold1&quot;</span>, <span class="st">&quot;gold2+&quot;</span>)</span>
<span id="cb1-132"><a href="#cb1-132" tabindex="-1"></a>Exac_per_GOLD[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">c</span>(total_rate,</span>
<span id="cb1-133"><a href="#cb1-133" tabindex="-1"></a>                           <span class="fu">round</span>(<span class="at">x=</span>GOLD_counts_all<span class="sc">/</span>Follow_up_GOLD_all_2level,</span>
<span id="cb1-134"><a href="#cb1-134" tabindex="-1"></a>                                 <span class="at">digit =</span> <span class="dv">2</span>))</span>
<span id="cb1-135"><a href="#cb1-135" tabindex="-1"></a>Exac_per_GOLD[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.39</span>, <span class="fl">0.28</span>, <span class="fl">0.53</span>)</span>
<span id="cb1-136"><a href="#cb1-136" tabindex="-1"></a></span>
<span id="cb1-137"><a href="#cb1-137" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(Exac_per_GOLD)</span>
<span id="cb1-138"><a href="#cb1-138" tabindex="-1"></a>dfm <span class="ot">&lt;-</span> <span class="fu">melt</span>(df[,<span class="fu">c</span>(<span class="st">&quot;GOLD&quot;</span>, <span class="st">&quot;EPIC&quot;</span>, <span class="st">&quot;CanCOLD&quot;</span>)],<span class="at">id.vars =</span> <span class="dv">1</span>)</span>
<span id="cb1-139"><a href="#cb1-139" tabindex="-1"></a>plot <span class="ot">&lt;-</span></span>
<span id="cb1-140"><a href="#cb1-140" tabindex="-1"></a>  <span class="fu">ggplot</span>(dfm, <span class="fu">aes</span>(<span class="at">x =</span> GOLD, <span class="at">y =</span> <span class="fu">as.numeric</span>(value))) <span class="sc">+</span></span>
<span id="cb1-141"><a href="#cb1-141" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">3</span>, <span class="at">by =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb1-142"><a href="#cb1-142" tabindex="-1"></a>  <span class="fu">theme_tufte</span>(<span class="at">base_size=</span><span class="dv">14</span>, <span class="at">ticks=</span>F)  <span class="sc">+</span></span>
<span id="cb1-143"><a href="#cb1-143" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">fill =</span> variable), <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">position =</span> <span class="st">&quot;dodge&quot;</span>) <span class="sc">+</span></span>
<span id="cb1-144"><a href="#cb1-144" tabindex="-1"></a>  <span class="fu">ylab</span> (<span class="st">&quot;Rate&quot;</span>) <span class="sc">+</span></span>
<span id="cb1-145"><a href="#cb1-145" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">caption =</span> <span class="st">&quot;Total rate of exacerbations per year for all patients&quot;</span>)</span>
<span id="cb1-146"><a href="#cb1-146" tabindex="-1"></a></span>
<span id="cb1-147"><a href="#cb1-147" tabindex="-1"></a><span class="fu">print</span>(plot)</span>
<span id="cb1-148"><a href="#cb1-148" tabindex="-1"></a></span>
<span id="cb1-149"><a href="#cb1-149" tabindex="-1"></a><span class="co">#--------------------------- total number of severe exacerbations:</span></span>
<span id="cb1-150"><a href="#cb1-150" tabindex="-1"></a></span>
<span id="cb1-151"><a href="#cb1-151" tabindex="-1"></a>n_exac <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">year=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>,<span class="at">Severe_Exacerbations =</span> (output_ex<span class="sc">$</span>n_exac_by_ctime_severity[,<span class="dv">3</span>]<span class="sc">+</span>output_ex<span class="sc">$</span>n_exac_by_ctime_severity[,<span class="dv">4</span>])<span class="sc">*</span> (<span class="dv">100000</span><span class="sc">/</span><span class="fu">rowSums</span>(output_ex<span class="sc">$</span>n_alive_by_ctime_sex)))</span>
<span id="cb1-152"><a href="#cb1-152" tabindex="-1"></a>avgRate_sevExac <span class="ot">&lt;-</span> <span class="fu">mean</span>(n_exac<span class="sc">$</span>Severe_Exacerbations[<span class="fu">round</span>(<span class="fu">nrow</span>(n_exac)<span class="sc">/</span><span class="dv">2</span>,<span class="dv">0</span>)<span class="sc">:</span><span class="fu">nrow</span>(n_exac)])</span>
<span id="cb1-153"><a href="#cb1-153" tabindex="-1"></a>avgRate_sevExac <span class="ot">&lt;-</span> <span class="fu">round</span>(avgRate_sevExac, <span class="dv">2</span>)</span>
<span id="cb1-154"><a href="#cb1-154" tabindex="-1"></a><span class="fu">message</span>(<span class="fu">paste0</span>(<span class="st">&quot;Average rate during 20 years: &quot;</span>, avgRate_sevExac))</span>
<span id="cb1-155"><a href="#cb1-155" tabindex="-1"></a></span>
<span id="cb1-156"><a href="#cb1-156" tabindex="-1"></a>rate2017_sevExac <span class="ot">&lt;-</span>(output_ex<span class="sc">$</span>n_exac_by_ctime_severity[<span class="dv">3</span>,<span class="dv">3</span>]<span class="sc">+</span>output_ex<span class="sc">$</span>n_exac_by_ctime_severity[<span class="dv">3</span>,<span class="dv">4</span>])<span class="sc">*</span>(<span class="dv">100000</span><span class="sc">/</span><span class="fu">sum</span>(output_ex<span class="sc">$</span>n_alive_by_ctime_sex[<span class="dv">3</span>,]))</span>
<span id="cb1-157"><a href="#cb1-157" tabindex="-1"></a>rate2017_sevExac <span class="ot">&lt;-</span> <span class="fu">round</span>(rate2017_sevExac, <span class="dv">2</span>)</span>
<span id="cb1-158"><a href="#cb1-158" tabindex="-1"></a><span class="fu">message</span>(<span class="fu">paste0</span>(<span class="st">&quot;Rate in 2017: &quot;</span>, rate2017_sevExac))</span>
<span id="cb1-159"><a href="#cb1-159" tabindex="-1"></a></span>
<span id="cb1-160"><a href="#cb1-160" tabindex="-1"></a></span>
<span id="cb1-161"><a href="#cb1-161" tabindex="-1"></a><span class="co">#----------------------------Diagnosed ------------------------------------</span></span>
<span id="cb1-162"><a href="#cb1-162" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------</span></span>
<span id="cb1-163"><a href="#cb1-163" tabindex="-1"></a></span>
<span id="cb1-164"><a href="#cb1-164" tabindex="-1"></a>Exac_per_GOLD_diagnosed <span class="ot">&lt;-</span> <span class="fu">matrix</span> (<span class="cn">NA</span>, <span class="at">nrow =</span> <span class="dv">4</span>, <span class="at">ncol =</span> <span class="dv">3</span>)</span>
<span id="cb1-165"><a href="#cb1-165" tabindex="-1"></a><span class="fu">colnames</span>(Exac_per_GOLD_diagnosed) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;GOLD&quot;</span>, <span class="st">&quot;EPIC&quot;</span>, <span class="st">&quot;Hoogendoorn&quot;</span>)</span>
<span id="cb1-166"><a href="#cb1-166" tabindex="-1"></a><span class="co"># ACCEPT data is rates from a join of ECLIPSE, MACRO, OPTIMAL and STATCOPE.</span></span>
<span id="cb1-167"><a href="#cb1-167" tabindex="-1"></a>Exac_per_GOLD_diagnosed[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;gold1&quot;</span>, <span class="st">&quot;gold2&quot;</span>, <span class="st">&quot;gold3&quot;</span>, <span class="st">&quot;gold4&quot;</span>)</span>
<span id="cb1-168"><a href="#cb1-168" tabindex="-1"></a>Exac_per_GOLD_diagnosed[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">round</span>(</span>
<span id="cb1-169"><a href="#cb1-169" tabindex="-1"></a>  <span class="at">x=</span><span class="fu">as.data.frame</span>(<span class="fu">table</span>(exac_events_diagnosed[, <span class="st">&quot;gold&quot;</span>]))[, <span class="dv">2</span>]<span class="sc">/</span></span>
<span id="cb1-170"><a href="#cb1-170" tabindex="-1"></a>    Follow_up_GOLD_diagnosed, <span class="at">digit =</span> <span class="dv">2</span>)</span>
<span id="cb1-171"><a href="#cb1-171" tabindex="-1"></a>Exac_per_GOLD_diagnosed[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.82</span>, <span class="fl">1.17</span>, <span class="fl">1.61</span>, <span class="fl">2.10</span>)</span>
<span id="cb1-172"><a href="#cb1-172" tabindex="-1"></a></span>
<span id="cb1-173"><a href="#cb1-173" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(Exac_per_GOLD_diagnosed)</span>
<span id="cb1-174"><a href="#cb1-174" tabindex="-1"></a>dfm <span class="ot">&lt;-</span> <span class="fu">melt</span>(df[,<span class="fu">c</span>(<span class="st">&quot;GOLD&quot;</span>, <span class="st">&quot;EPIC&quot;</span>, <span class="st">&quot;Hoogendoorn&quot;</span>)],<span class="at">id.vars =</span> <span class="dv">1</span>)</span>
<span id="cb1-175"><a href="#cb1-175" tabindex="-1"></a>plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(dfm, <span class="fu">aes</span>(<span class="at">x =</span> GOLD, <span class="at">y =</span> <span class="fu">as.numeric</span>(value))) <span class="sc">+</span></span>
<span id="cb1-176"><a href="#cb1-176" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">3</span>, <span class="at">by =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb1-177"><a href="#cb1-177" tabindex="-1"></a>  <span class="fu">theme_tufte</span>(<span class="at">base_size=</span><span class="dv">14</span>, <span class="at">ticks=</span>F)  <span class="sc">+</span></span>
<span id="cb1-178"><a href="#cb1-178" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">fill =</span> variable), <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">position =</span> <span class="st">&quot;dodge&quot;</span>) <span class="sc">+</span></span>
<span id="cb1-179"><a href="#cb1-179" tabindex="-1"></a>  <span class="fu">ylab</span> (<span class="st">&quot;Rate&quot;</span>) <span class="sc">+</span></span>
<span id="cb1-180"><a href="#cb1-180" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">caption =</span> <span class="st">&quot;Total rate of exacerbations per year for diagnosed patients&quot;</span>)</span>
<span id="cb1-181"><a href="#cb1-181" tabindex="-1"></a><span class="fu">print</span>(plot)</span>
<span id="cb1-182"><a href="#cb1-182" tabindex="-1"></a></span>
<span id="cb1-183"><a href="#cb1-183" tabindex="-1"></a><span class="fu">message</span>(<span class="st">&quot;Total rate of exacerbation in diagnosed patients (1.5 per year in Hoogendoorn): &quot;</span>, <span class="fu">round</span>(<span class="fu">nrow</span>(exac_events_diagnosed)<span class="sc">/</span><span class="fu">sum</span>(Follow_up_GOLD_diagnosed), <span class="dv">2</span>))</span>
<span id="cb1-184"><a href="#cb1-184" tabindex="-1"></a></span>
<span id="cb1-185"><a href="#cb1-185" tabindex="-1"></a></span>
<span id="cb1-186"><a href="#cb1-186" tabindex="-1"></a><span class="co">#----------------------------Diagnosed Moderate and Severe------------------------------------</span></span>
<span id="cb1-187"><a href="#cb1-187" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------</span></span>
<span id="cb1-188"><a href="#cb1-188" tabindex="-1"></a></span>
<span id="cb1-189"><a href="#cb1-189" tabindex="-1"></a>Exac_per_GOLD_diagnosed <span class="ot">&lt;-</span> <span class="fu">matrix</span> (<span class="cn">NA</span>, <span class="at">nrow =</span> <span class="dv">4</span>, <span class="at">ncol =</span> <span class="dv">3</span>)</span>
<span id="cb1-190"><a href="#cb1-190" tabindex="-1"></a><span class="fu">colnames</span>(Exac_per_GOLD_diagnosed) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;GOLD&quot;</span>, <span class="st">&quot;EPIC&quot;</span>, <span class="st">&quot;Wallace 2019&quot;</span>)</span>
<span id="cb1-191"><a href="#cb1-191" tabindex="-1"></a></span>
<span id="cb1-192"><a href="#cb1-192" tabindex="-1"></a>Exac_per_GOLD_diagnosed[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;gold1&quot;</span>, <span class="st">&quot;gold2&quot;</span>, <span class="st">&quot;gold3&quot;</span>, <span class="st">&quot;gold4&quot;</span>)</span>
<span id="cb1-193"><a href="#cb1-193" tabindex="-1"></a>Exac_per_GOLD_diagnosed[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">round</span>(</span>
<span id="cb1-194"><a href="#cb1-194" tabindex="-1"></a>  <span class="at">x=</span><span class="fu">as.data.frame</span>(<span class="fu">table</span>(mod_sev_exac_events_diagnosed[, <span class="st">&quot;gold&quot;</span>]))[, <span class="dv">2</span>]<span class="sc">/</span></span>
<span id="cb1-195"><a href="#cb1-195" tabindex="-1"></a>    Follow_up_GOLD_diagnosed, <span class="at">digit =</span> <span class="dv">2</span>)</span>
<span id="cb1-196"><a href="#cb1-196" tabindex="-1"></a>Exac_per_GOLD_diagnosed[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.404</span>, <span class="fl">0.489</span>, <span class="fl">0.836</span>, <span class="fl">0.891</span>)</span>
<span id="cb1-197"><a href="#cb1-197" tabindex="-1"></a></span>
<span id="cb1-198"><a href="#cb1-198" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(Exac_per_GOLD_diagnosed)</span>
<span id="cb1-199"><a href="#cb1-199" tabindex="-1"></a>dfm <span class="ot">&lt;-</span> <span class="fu">melt</span>(df[,<span class="fu">c</span>(<span class="st">&quot;GOLD&quot;</span>, <span class="st">&quot;EPIC&quot;</span>, <span class="st">&quot;Wallace 2019&quot;</span>)],<span class="at">id.vars =</span> <span class="dv">1</span>)</span>
<span id="cb1-200"><a href="#cb1-200" tabindex="-1"></a>plot <span class="ot">&lt;-</span></span>
<span id="cb1-201"><a href="#cb1-201" tabindex="-1"></a>  <span class="fu">ggplot</span>(dfm, <span class="fu">aes</span>(<span class="at">x =</span> GOLD, <span class="at">y =</span> <span class="fu">as.numeric</span>(value))) <span class="sc">+</span></span>
<span id="cb1-202"><a href="#cb1-202" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">3</span>, <span class="at">by =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb1-203"><a href="#cb1-203" tabindex="-1"></a>  <span class="fu">theme_tufte</span>(<span class="at">base_size=</span><span class="dv">14</span>, <span class="at">ticks=</span>F)  <span class="sc">+</span></span>
<span id="cb1-204"><a href="#cb1-204" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">fill =</span> variable), <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">position =</span> <span class="st">&quot;dodge&quot;</span>) <span class="sc">+</span></span>
<span id="cb1-205"><a href="#cb1-205" tabindex="-1"></a>  <span class="fu">ylab</span> (<span class="st">&quot;Rate&quot;</span>) <span class="sc">+</span></span>
<span id="cb1-206"><a href="#cb1-206" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">caption =</span> <span class="st">&quot;Total rate of moderate/severe exacerbations per year for diagnosed patients&quot;</span>)</span>
<span id="cb1-207"><a href="#cb1-207" tabindex="-1"></a></span>
<span id="cb1-208"><a href="#cb1-208" tabindex="-1"></a><span class="fu">print</span>(plot)</span>
<span id="cb1-209"><a href="#cb1-209" tabindex="-1"></a></span>
<span id="cb1-210"><a href="#cb1-210" tabindex="-1"></a></span>
<span id="cb1-211"><a href="#cb1-211" tabindex="-1"></a><span class="co">#----------------------------Diagnosed Severe------------------------------------</span></span>
<span id="cb1-212"><a href="#cb1-212" tabindex="-1"></a><span class="co">#-------------------------------------------------------------------------</span></span>
<span id="cb1-213"><a href="#cb1-213" tabindex="-1"></a></span>
<span id="cb1-214"><a href="#cb1-214" tabindex="-1"></a>Exac_per_GOLD_diagnosed <span class="ot">&lt;-</span> <span class="fu">matrix</span> (<span class="cn">NA</span>, <span class="at">nrow =</span> <span class="dv">4</span>, <span class="at">ncol =</span> <span class="dv">3</span>)</span>
<span id="cb1-215"><a href="#cb1-215" tabindex="-1"></a><span class="fu">colnames</span>(Exac_per_GOLD_diagnosed) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;GOLD&quot;</span>, <span class="st">&quot;EPIC&quot;</span>, <span class="st">&quot;Wallace 2019&quot;</span>)</span>
<span id="cb1-216"><a href="#cb1-216" tabindex="-1"></a></span>
<span id="cb1-217"><a href="#cb1-217" tabindex="-1"></a>Exac_per_GOLD_diagnosed[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;gold1&quot;</span>, <span class="st">&quot;gold2&quot;</span>, <span class="st">&quot;gold3&quot;</span>, <span class="st">&quot;gold4&quot;</span>)</span>
<span id="cb1-218"><a href="#cb1-218" tabindex="-1"></a>Exac_per_GOLD_diagnosed[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">round</span>(</span>
<span id="cb1-219"><a href="#cb1-219" tabindex="-1"></a>  <span class="at">x=</span><span class="fu">as.data.frame</span>(<span class="fu">table</span>(sev_exac_events_diagnosed[, <span class="st">&quot;gold&quot;</span>]))[, <span class="dv">2</span>]<span class="sc">/</span></span>
<span id="cb1-220"><a href="#cb1-220" tabindex="-1"></a>    Follow_up_GOLD_diagnosed, <span class="at">digit =</span> <span class="dv">2</span>)</span>
<span id="cb1-221"><a href="#cb1-221" tabindex="-1"></a>Exac_per_GOLD_diagnosed[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.12</span>, <span class="fl">0.139</span>, <span class="fl">0.254</span>, <span class="fl">0.422</span>)</span>
<span id="cb1-222"><a href="#cb1-222" tabindex="-1"></a></span>
<span id="cb1-223"><a href="#cb1-223" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(Exac_per_GOLD_diagnosed)</span>
<span id="cb1-224"><a href="#cb1-224" tabindex="-1"></a>dfm <span class="ot">&lt;-</span> <span class="fu">melt</span>(df[,<span class="fu">c</span>(<span class="st">&quot;GOLD&quot;</span>, <span class="st">&quot;EPIC&quot;</span>, <span class="st">&quot;Wallace 2019&quot;</span>)],<span class="at">id.vars =</span> <span class="dv">1</span>)</span>
<span id="cb1-225"><a href="#cb1-225" tabindex="-1"></a>plot <span class="ot">&lt;-</span></span>
<span id="cb1-226"><a href="#cb1-226" tabindex="-1"></a>  <span class="fu">ggplot</span>(dfm, <span class="fu">aes</span>(<span class="at">x =</span> GOLD, <span class="at">y =</span> <span class="fu">as.numeric</span>(value))) <span class="sc">+</span></span>
<span id="cb1-227"><a href="#cb1-227" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">3</span>, <span class="at">by =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb1-228"><a href="#cb1-228" tabindex="-1"></a>  <span class="fu">theme_tufte</span>(<span class="at">base_size=</span><span class="dv">14</span>, <span class="at">ticks=</span>F)  <span class="sc">+</span></span>
<span id="cb1-229"><a href="#cb1-229" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">fill =</span> variable), <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">position =</span> <span class="st">&quot;dodge&quot;</span>) <span class="sc">+</span></span>
<span id="cb1-230"><a href="#cb1-230" tabindex="-1"></a>  <span class="fu">ylab</span> (<span class="st">&quot;Rate&quot;</span>) <span class="sc">+</span></span>
<span id="cb1-231"><a href="#cb1-231" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">caption =</span> <span class="st">&quot;Total rate of severe exacerbations per year for diagnosed patients&quot;</span>)</span>
<span id="cb1-232"><a href="#cb1-232" tabindex="-1"></a></span>
<span id="cb1-233"><a href="#cb1-233" tabindex="-1"></a><span class="fu">print</span>(plot)</span>
<span id="cb1-234"><a href="#cb1-234" tabindex="-1"></a></span>
<span id="cb1-235"><a href="#cb1-235" tabindex="-1"></a><span class="co">#----------------------------Undiagnosed ------------------------------------</span></span>
<span id="cb1-236"><a href="#cb1-236" tabindex="-1"></a><span class="co">#----------------------------------------------------------------------------</span></span>
<span id="cb1-237"><a href="#cb1-237" tabindex="-1"></a>total_rate_undiagnosed <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">nrow</span>(exac_events_undiagnosed)<span class="sc">/</span><span class="fu">sum</span>(Follow_up_GOLD_undiagnosed), <span class="dv">2</span>)</span>
<span id="cb1-238"><a href="#cb1-238" tabindex="-1"></a>Exac_per_GOLD_undiagnosed <span class="ot">&lt;-</span> <span class="fu">matrix</span> (<span class="cn">NA</span>, <span class="at">nrow =</span> <span class="dv">3</span>, <span class="at">ncol =</span> <span class="dv">3</span>)</span>
<span id="cb1-239"><a href="#cb1-239" tabindex="-1"></a><span class="fu">colnames</span>(Exac_per_GOLD_undiagnosed) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;GOLD&quot;</span>, <span class="st">&quot;EPIC&quot;</span>, <span class="st">&quot;CanCOLD&quot;</span>)</span>
<span id="cb1-240"><a href="#cb1-240" tabindex="-1"></a>Exac_per_GOLD_undiagnosed[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;total&quot;</span>, <span class="st">&quot;gold1&quot;</span>, <span class="st">&quot;gold2+&quot;</span>)</span>
<span id="cb1-241"><a href="#cb1-241" tabindex="-1"></a></span>
<span id="cb1-242"><a href="#cb1-242" tabindex="-1"></a>Follow_up_GOLD_undiagnosed_2level <span class="ot">&lt;-</span> <span class="fu">c</span>(Follow_up_GOLD_undiagnosed[<span class="dv">1</span>],</span>
<span id="cb1-243"><a href="#cb1-243" tabindex="-1"></a>                                       Follow_up_GOLD_undiagnosed[<span class="dv">2</span>]) <span class="co">#Because CANCold is mostly GOLD2, we comprare to GOLD2 EPIC</span></span>
<span id="cb1-244"><a href="#cb1-244" tabindex="-1"></a><span class="co">#Follow_up_GOLD_undiagnosed_2level &lt;- c(Follow_up_GOLD_undiagnosed[1], sum(Follow_up_GOLD_undiagnosed[2:4]))</span></span>
<span id="cb1-245"><a href="#cb1-245" tabindex="-1"></a>GOLD_counts_undiagnosed   <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">table</span>(exac_events_undiagnosed[, <span class="st">&quot;gold&quot;</span>]))[, <span class="dv">2</span>]</span>
<span id="cb1-246"><a href="#cb1-246" tabindex="-1"></a>GOLD_counts_undiagnosed   <span class="ot">&lt;-</span> <span class="fu">c</span>(GOLD_counts_undiagnosed[<span class="dv">1</span>],</span>
<span id="cb1-247"><a href="#cb1-247" tabindex="-1"></a>                               GOLD_counts_undiagnosed[<span class="dv">2</span>])</span>
<span id="cb1-248"><a href="#cb1-248" tabindex="-1"></a></span>
<span id="cb1-249"><a href="#cb1-249" tabindex="-1"></a></span>
<span id="cb1-250"><a href="#cb1-250" tabindex="-1"></a>Exac_per_GOLD_undiagnosed[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">c</span>(total_rate_undiagnosed,</span>
<span id="cb1-251"><a href="#cb1-251" tabindex="-1"></a>                                       <span class="fu">round</span>(<span class="at">x=</span>GOLD_counts_undiagnosed<span class="sc">/</span>Follow_up_GOLD_undiagnosed_2level, <span class="at">digit =</span> <span class="dv">2</span>))</span>
<span id="cb1-252"><a href="#cb1-252" tabindex="-1"></a>Exac_per_GOLD_undiagnosed[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.30</span>, <span class="fl">0.24</span>, <span class="fl">0.40</span>)</span>
<span id="cb1-253"><a href="#cb1-253" tabindex="-1"></a></span>
<span id="cb1-254"><a href="#cb1-254" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(Exac_per_GOLD_undiagnosed)</span>
<span id="cb1-255"><a href="#cb1-255" tabindex="-1"></a>dfm <span class="ot">&lt;-</span> <span class="fu">melt</span>(df[,<span class="fu">c</span>(<span class="st">&quot;GOLD&quot;</span>, <span class="st">&quot;EPIC&quot;</span>, <span class="st">&quot;CanCOLD&quot;</span>)],<span class="at">id.vars =</span> <span class="dv">1</span>)</span>
<span id="cb1-256"><a href="#cb1-256" tabindex="-1"></a>plot <span class="ot">&lt;-</span></span>
<span id="cb1-257"><a href="#cb1-257" tabindex="-1"></a>  <span class="fu">ggplot</span>(dfm, <span class="fu">aes</span>(<span class="at">x =</span> GOLD, <span class="at">y =</span> <span class="fu">as.numeric</span>(value))) <span class="sc">+</span></span>
<span id="cb1-258"><a href="#cb1-258" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">3</span>, <span class="at">by =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb1-259"><a href="#cb1-259" tabindex="-1"></a>  <span class="fu">theme_tufte</span>(<span class="at">base_size=</span><span class="dv">14</span>, <span class="at">ticks=</span>F)  <span class="sc">+</span></span>
<span id="cb1-260"><a href="#cb1-260" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">fill =</span> variable), <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">position =</span> <span class="st">&quot;dodge&quot;</span>) <span class="sc">+</span></span>
<span id="cb1-261"><a href="#cb1-261" tabindex="-1"></a>  <span class="fu">ylab</span> (<span class="st">&quot;Rate&quot;</span>) <span class="sc">+</span></span>
<span id="cb1-262"><a href="#cb1-262" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">caption =</span> <span class="st">&quot;Total rate of exacerbations per year for undiagnosed patients&quot;</span>)</span>
<span id="cb1-263"><a href="#cb1-263" tabindex="-1"></a><span class="fu">print</span>(plot)</span>
<span id="cb1-264"><a href="#cb1-264" tabindex="-1"></a></span>
<span id="cb1-265"><a href="#cb1-265" tabindex="-1"></a><span class="fu">message</span>(<span class="st">&quot;Total rate of exacerbation in undiagnosed patients (0.30 per year in CanCOLD): &quot;</span>,</span>
<span id="cb1-266"><a href="#cb1-266" tabindex="-1"></a>        total_rate_undiagnosed)</span></code></pre></div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
